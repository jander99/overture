# Changelog

All notable changes to the Overture project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [0.4.0] - 2025-12-21

### Added

- **Import & Cleanup Commands** - New workflow for migrating from client configs to Overture
  - `overture import` - Discover and import unmanaged MCPs from AI client configs
    - Interactive TUI with @clack/prompts for beautiful selection experience
    - Auto-detects MCPs from Claude Code, OpenCode, and Copilot CLI
    - Converts hardcoded secrets to `${VAR}` environment variable references
    - Cross-client conflict detection with detailed reporting
    - Supports both global (`~/.config/overture/config.yaml`) and project (`.overture/config.yaml`) scopes
    - Automatic scope inference based on source location
    - Dry-run mode for previewing changes
  - `overture cleanup` - Remove Overture-managed MCPs from directory configs
    - Cleans up Claude Code's `~/.claude.json → projects[path].mcpServers`
    - Interactive directory selection with multiselect
    - Preserves unmanaged MCPs with warnings
    - Creates automatic backups before modifications
    - Dry-run support for safe preview
- **New Library: `@overture/import-core`** (1,115 lines)
  - `ImportService` - MCP discovery and import from client configs
  - `CleanupService` - Directory-based config cleanup
  - `EnvVarConverter` - Hardcoded secret detection and conversion
  - `ConflictDetector` - Cross-client configuration conflict detection
- **Environment Variable Validation** in sync engine
  - Pre-sync validation of all env vars in Overture config
  - Missing variable detection with helpful error messages
  - Export command suggestions for setting required vars
- **Claude Code Directory Config Support**
  - Read/write full `~/.claude.json` including `projects` object
  - `cleanupDirectoryMcps()` method for selective MCP removal
  - Preserves all other project settings (enabledMcpjsonServers, etc.)
- **OpenCode Format Conversion**
  - Bidirectional `{env:VAR}` ↔ `${VAR}` conversion
  - `translateFromOpenCodeEnv()` and `translateToOpenCodeEnv()` adapters
- **Comprehensive Test Suite** (56 tests, 78% coverage)
  - ImportService: 10 tests (58% coverage)
  - CleanupService: 10 tests (98% coverage)
  - EnvVarConverter: 25 tests (87% coverage)
  - ConflictDetector: 11 tests (95% coverage)
  - Test fixtures for all 3 clients
- **New Documentation**
  - `docs/howtos/importing-existing-configs.md` (420 lines)
    - Complete step-by-step import workflow
    - Scope inference rules for all clients
    - Conflict resolution strategies
    - Environment variable best practices
    - Cleanup command usage
    - Troubleshooting guide

### Changed

- **Sync Engine Enhancement**
  - Added environment variable validation before sync
  - Shows which MCPs require which env vars
  - Provides export instructions for missing vars
- **Client Adapters Enhanced**
  - `ClaudeCodeAdapter`: Added `readFullConfig()`, `cleanupDirectoryMcps()`, `writeFullConfig()`
  - `OpenCodeAdapter`: Added `translateFromOpenCodeEnv()`, `translateToOpenCodeEnv()`

### Documentation

- Updated `docs/roadmap.md` with v0.4.0 completion
- Added import & cleanup as completed features
- Created comprehensive import workflow documentation
- Added real-world examples and troubleshooting

## [0.3.0] - 2025-12-20

### Breaking Changes

- **REMOVED:** Support for 7 AI clients:
  - Claude Desktop
  - VS Code (Copilot extension)
  - Cursor IDE
  - Windsurf IDE
  - JetBrains (Copilot extension)
  - OpenAI Codex CLI
  - Google Gemini CLI
- **STREAMLINED:** Focus on 3 production-ready clients: **Claude Code**, **GitHub Copilot CLI**, and **OpenCode**
- Configurations for removed clients will no longer be generated by `overture sync`
- Users of removed clients should migrate to supported alternatives (see Migration Notes below)

### Added

- **GitHub Copilot CLI adapter** with full MCP support
  - User config: `~/.config/github-copilot/mcp.json` (XDG_CONFIG_HOME support on Linux)
  - Project config: `./.github/mcp.json`
  - Automatic GitHub MCP exclusion (Copilot CLI bundles GitHub MCP by default)
  - Native `${VAR}` environment variable support
- **Comprehensive test suite** for Copilot CLI adapter (41 tests)
- **XDG_CONFIG_HOME support** for Copilot CLI on Linux platforms

### Changed

- **Default sync targets** reduced from 8 clients to 3
  - `claude-code`, `copilot-cli`, `opencode`
  - Faster sync execution with fewer moving parts
- **Simplified binary detection** (removed 7 client implementations)
- **Updated documentation** to reflect 3-client architecture
  - README comparison matrix now focuses on 3 supported clients
  - User guide examples updated with current client output
  - Added deprecation notices to archived research docs
- **`ALL_CLIENTS` array** in doctor command now contains only 3 clients

### Fixed

- TypeScript compilation errors in `discovery-service.ts` (removed GUI app paths for deleted clients)
- WSL2 detector references to deleted clients in `WINDOWS_DEFAULT_PATHS`
- Doctor command installation URLs for removed clients
- GUI app path detection (all 3 supported clients are CLI-only, simplified to empty object)

### Removed

- **Client adapters** for 7 unsupported clients
- **Binary detection** logic for removed clients
- **Installation URLs** for removed clients in doctor command
- **Research documentation** for Codex CLI and Gemini CLI (deleted from archive)

### Documentation

- Updated **README.md**:
  - Streamlined comparison matrix to 3 clients
  - Updated roadmap to mark v0.3.0 complete
  - Removed references to unsupported clients
- Updated **docs/user-guide.md**:
  - Updated command examples (doctor, sync)
  - Corrected client detection output
- Updated **AGENTS.md**:
  - Updated version to v0.3.0
  - Corrected client count and test count
- **Added deprecation notices** to:
  - `docs/archive/mcp-format-differences-2025-12-14.md`
  - `docs/archive/multi-cli-roadmap-2025-12-18.md`
- **Deleted obsolete research**:
  - `docs/archive/codex-cli-research-2025-12-14.md`
  - `docs/archive/gemini-cli-research-2025-12-14.md`

### Technical Details

- **Test Coverage:** 384 total tests passing (277 CLI + 107 adapters)
- **Code Coverage:** 83%+ maintained across all modules
- **Build System:** Clean TypeScript compilation with no errors or warnings
- **Architecture:** Simplified sync engine with reduced complexity

### Migration Notes

**If you were using removed clients:**

| Old Client          | Recommended Migration Path                                    |
| ------------------- | ------------------------------------------------------------- |
| Claude Desktop      | Migrate to **Claude Code** (same Claude models, CLI workflow) |
| VS Code (Copilot)   | Use **GitHub Copilot CLI** or **OpenCode** in terminal        |
| Cursor IDE          | Use **OpenCode** (open-source, highly configurable)           |
| Windsurf IDE        | Use **Claude Code** or **OpenCode**                           |
| JetBrains (Copilot) | Use **GitHub Copilot CLI** in terminal alongside IDE          |
| Codex CLI           | Use **Claude Code** or **GitHub Copilot CLI**                 |
| Gemini CLI          | Use **Claude Code** (superior MCP ecosystem)                  |

**Configuration migration:**

- Existing `~/.config/overture.yml` files remain compatible
- MCP server definitions are unchanged
- Simply run `overture sync` after upgrading to v0.3.0
- Configs will only be generated for the 3 supported clients

**Need the old clients?**

- Stay on Overture v0.2.5 (frozen, maintenance mode only)
- Or fork the project and maintain removed adapters independently

For detailed migration assistance, see the [User Guide](docs/user-guide.md) or open a GitHub discussion.

## [0.2.5] - 2025-01-15

### Added

**Binary Detection Service** - Automatically detects installed AI clients

- Detects CLI binaries in PATH (using which/where commands)
- Detects GUI application bundles via filesystem checks
- Extracts version information via --version flags
- Validates config file JSON integrity
- 5-second timeout per detection to prevent hangs

**Doctor Command** - System diagnostics and health check

- `overture doctor` shows all installed clients with versions
- Validates config file locations and JSON validity
- Checks MCP server command availability
- Supports `--json` and `--verbose` flags
- Provides installation recommendations for missing clients

**Enhanced Sync Output** - Better visibility into detection results

- Shows detection status for each client (found/not-found)
- Displays binary/app bundle paths and version information
- Shows config file validity status
- "Warn but allow" approach - generates configs even if client not detected

**Configuration Options**

- `skipBinaryDetection` flag for CI/CD environments
- Allows config generation without installed clients

### Changed

**Client Adapters Enhanced with Detection**

- All 7 client adapters now implement detection methods:
  - `getBinaryNames()` - CLI binaries to check
  - `getAppBundlePaths()` - Platform-specific app paths
  - `requiresBinary()` - Required vs optional detection
- Centralized detection logic prevents code duplication across adapters

**Sync Engine**

- Integrated binary detection into sync workflow
- Populates `binaryDetection` field in sync results
- Generates configs for all clients (detected or not)
- Warnings logged for undetected clients

### Technical

**Testing**

- Added 17 new tests (10 binary-detector + 7 doctor command)
- Test count: 911 passing (100%), 83%+ code coverage
- Comprehensive integration tests for detection service
- Doctor command structure tests

**Architecture**

- Platform-aware detection (darwin/linux/win32)
- Graceful degradation with timeout protection
- Hybrid approach: adapters declare, BinaryDetector detects
- No code duplication across client implementations

### Documentation

- Updated README.md with v0.2.5 features and doctor command
- Created migration guide (docs/migration-v0.2-to-v0.2.5.md)
- Enhanced Commands section with diagnostics and options
- Added v0.2.5 to roadmap

### Files Added

- `apps/cli/src/core/binary-detector.ts` - Binary detection service
- `apps/cli/src/core/binary-detector.spec.ts` - Detection tests
- `apps/cli/src/cli/commands/doctor.ts` - Diagnostics command
- `apps/cli/src/cli/commands/doctor.spec.ts` - Command tests
- `docs/migration-v0.2-to-v0.2.5.md` - Migration guide
- `docs/v0.2.5-implementation-plan.md` - Implementation plan

### Files Modified

- All 7 client adapters with override methods
- `apps/cli/src/core/sync-engine.ts` - Detection integration
- `apps/cli/src/cli/commands/sync.ts` - Enhanced output
- `apps/cli/src/domain/config.types.ts` - Detection types
- `apps/cli/src/domain/config.schema.ts` - Schema updates

## [0.2.1] - 2025-01-11

### Enhanced

**Dry-Run Mode with Debug Output**

Changed:

- `--dry-run` flag now writes generated configs to `dist/` directory for inspection
- Config files are prepended with client name (e.g., `dist/claude-code-mcp.json`, `dist/vscode-mcp.json`)
- Enables debugging and tuning without affecting actual client configurations
- Users can inspect exact configs that would be written before applying

Files Modified:

- `apps/cli/src/core/sync-engine.ts` - Added `getDryRunOutputPath()` and `ensureDistDirectory()` helpers
- `apps/cli/src/cli/commands/sync.ts` - Updated dry-run messaging to inform users about dist/ output

Usage:

```bash
# Preview changes and write debug configs to dist/
overture sync --dry-run

# Inspect generated configs
ls -la dist/
cat dist/claude-code-mcp.json

# Apply changes after review
overture sync
```

## [0.2.0] - 2025-01-13

### Multi-Platform MCP Manager - COMPLETE

**Status:** ✅ COMPLETE
**Tests:** 873 passing, 32 test suites, 83%+ code coverage

Overture v0.2 delivers comprehensive multi-platform MCP configuration management with:

- User global configuration (`~/.config/overture.yml`)
- Project/user config merging with proper precedence
- 7 platform adapters (Claude Code, Claude Desktop, Cursor, Windsurf, VSCode, Copilot CLI, JetBrains)
- Multi-client sync engine with backup/restore
- Config audit for detecting unmanaged MCPs
- Transport validation and platform filtering
- Process locking for safe concurrent operations

#### Implementation Details

**Phase 2: Client Adapters (16 WUs, 653 tests)**

Added:

- Multi-client adapter architecture supporting 7 AI development clients
- `BaseClientAdapter` abstract class with common filtering logic
- `adapter-registry.ts` for centralized adapter management
- Core adapters:
  - `claude-code-adapter.ts` - Claude Code CLI (stdio + http)
  - `claude-desktop-adapter.ts` - Claude Desktop app (stdio + sse)
  - `vscode-adapter.ts` - VS Code MCP extension (stdio only)
- Extended adapters:
  - `cursor-adapter.ts` - Cursor IDE (stdio + http)
  - `windsurf-adapter.ts` - Windsurf IDE (stdio only)
  - `copilot-cli-adapter.ts` - GitHub Copilot CLI (stdio only)
  - `jetbrains-copilot-adapter.ts` - JetBrains GitHub Copilot plugin (stdio only)
- Comprehensive test coverage for all adapters (31 tests for extended adapters)

**Phase 3: Sync Engine (10 WUs, 802 tests)**

Added:

- `config-diff.ts` - Configuration diff generation with field-level change detection (19 tests)
- `backup-service.ts` - Timestamped backup creation with retention policy (34 tests)
- `restore-service.ts` - Backup restoration with validation (16 tests)
- `process-lock.ts` - File-based process locking with stale detection (18 tests)
- `exclusion-filter.ts` - MCP filtering by platform/client/transport/scope (16 tests)
- `transport-validator.ts` - Transport compatibility validation (22 tests)
- `client-env-service.ts` - Client-aware environment variable expansion (19 tests)
- `sync-engine.ts` - Main orchestration layer coordinating entire sync workflow (21 tests)

Features:

- Dry-run mode for previewing changes without writing
- Force flag to override transport warnings
- Scope filtering (global vs project MCPs)
- Client filtering (sync specific clients only)
- Platform auto-detection (darwin, linux, win32)
- Automatic backup before config updates
- Diff generation showing what changed
- Process locking preventing concurrent syncs
- Graceful error handling with detailed results per client

**Phase 4: Commands & CLI Integration (Complete)**

Added:

- `overture user init` - Interactive user global config setup
- `overture user show` - Display user config in YAML or JSON
- `overture audit` - Detect unmanaged MCPs across clients
- `overture backup list` - List all backups
- `overture backup restore` - Restore from backup
- `overture backup cleanup` - Remove old backups
- Enhanced `overture sync` with multi-client support, dry-run, client filtering

**Phase 5: Testing & Documentation (Complete)**

Achieved:

- ✅ 873 tests passing (100% pass rate)
- ✅ 32 test suites covering all components
- ✅ 83%+ code coverage (statements: 83.03%, functions: 86.7%, branches: 69.18%)
- ✅ Comprehensive integration tests
- ✅ Performance benchmarks (11 scenarios, A-grade performance)
- ✅ Documentation updates (README, CLAUDE.md, PURPOSE.md, CHANGELOG)
- ✅ Migration guide from v0.1 (docs/migration-v0.1-to-v0.2.md)

## [0.1.0] - 2024-11-09

### Added

**Phase 1: Foundation**

- Initial Nx monorepo setup with TypeScript
- Domain types and Zod validation schemas
  - `config-v2.types.ts` - TypeScript interfaces for v2 config
  - `config-v2.schema.ts` - Zod validators for runtime validation
- Core utilities:
  - `path-resolver.ts` - Cross-platform path resolution
  - `env-expander.ts` - Environment variable expansion with ${VAR} syntax
  - `config-loader.ts` - Config loading with user/project precedence
- Template system with Handlebars
- CLI commands:
  - `overture init` - Initialize .overture/config.yaml
  - `overture sync` - Install plugins and generate configs
  - `overture validate` - Validate configuration
  - `overture mcp list` - List configured MCPs
  - `overture mcp enable` - Enable disabled MCPs
- CLAUDE.md generation with Nx-style paired markers
- Comprehensive test suite (191 tests)

### Technical Details

- **Build System:** Nx with esbuild bundler
- **Target:** CommonJS (not ESM)
- **Dependencies:** commander, zod, js-yaml, chalk@4.1.2, inquirer@8.2.6, execa@5.1.1, handlebars
- **Platform Support:** macOS (darwin), Linux, Windows (win32)

## Architecture Decisions

### Multi-Client Adapter Pattern

**Decision:** Use abstract base class with concrete implementations per client

**Rationale:**

- Isolates client-specific logic
- Provides uniform interface for sync engine
- Easy to add new clients
- Testable in isolation

**Implementation:**

```typescript
abstract class BaseClientAdapter {
  abstract name: ClientName;
  abstract detectConfigPath(platform: Platform): ConfigPathResult;
  abstract convertFromOverture(config: OvertureConfigV2): ClientMcpConfig;
  // ... more methods

  // Helper method for common filtering logic
  protected shouldSyncMcp(mcpConfig, platform): boolean;
}
```

### Config Precedence

**Decision:** Project config overrides user config

**Rationale:**

- Project-specific needs trump user defaults
- Allows teams to standardize MCPs per project
- User config provides sensible defaults

### Environment Variable Expansion

**Decision:** Client-aware expansion (native vs Overture-managed)

**Clients with Native Support:**

- Claude Code, Claude Desktop, Cursor, Windsurf, Copilot CLI
- Keep ${VAR} syntax in config, client expands at runtime

**Clients Requiring Overture Expansion:**

- VS Code, JetBrains Copilot
- Overture expands ${VAR} before writing config

**Rationale:**

- Respects client capabilities
- Prevents double-expansion issues
- Maintains compatibility

### Transport Validation

**Decision:** Check compatibility BEFORE filtering

**Rationale:**

- Provides clear warnings about unsupported transports
- Filtering would hide the incompatibility
- User can use --force to override if needed

### Process Safety

**Decision:** File-based locking with stale detection

**Rationale:**

- Prevents concurrent sync operations
- Stale detection prevents deadlocks (10s timeout)
- Exponential backoff for retries
- Auto-cleanup on exit (SIGINT, SIGTERM, uncaught exceptions)

## [Links]

- [Implementation Plan](docs/v0.2-implementation-plan.md)
- [Architecture Documentation](docs/v0.2-architecture.md)
- [Purpose & Vision](docs/PURPOSE.md)
- [User Guide](docs/user-guide.md)
