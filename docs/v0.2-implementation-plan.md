# Overture v0.2 Parallel Execution Implementation Plan

**Version:** 1.0  
**Date:** 2025-11-11  
**Target Release:** v0.2.0 (MVP) + v0.2.1 (Extended)  
**Estimated Timeline:** 5 weeks with parallel agent execution

---

## Table of Contents

1. [Implementation Overview](#1-implementation-overview)
2. [Dependency Graph](#2-dependency-graph)
3. [Work Units (46 Total)](#3-work-units-46-total)
4. [Parallel Execution Strategy](#4-parallel-execution-strategy)
5. [Memory Graph Design](#5-memory-graph-design)
6. [Risk Assessment](#6-risk-assessment)
7. [Testing Strategy](#7-testing-strategy)
8. [Rollout Plan](#8-rollout-plan)

---

## 1. Implementation Overview

### 1.1 High-Level Phases

| Phase | Focus | Duration | Parallel Groups | Work Units |
|-------|-------|----------|-----------------|------------|
| Phase 1 | Foundation & Schema | Week 1 | A, B, C | WU-001 to WU-007 (7 units) |
| Phase 2 | Core Adapters | Week 2 | D, E, F, G | WU-008 to WU-016 (9 units) |
| Phase 3 | Sync Engine | Week 3 | H, I, J | WU-017 to WU-026 (10 units) |
| Phase 4 | Commands & Validation | Week 4 | K, L, M | WU-027 to WU-035 (9 units) |
| Phase 5 | Testing & Polish | Week 5 | N, O, P, Q | WU-036 to WU-046 (11 units) |

**Total Work Units:** 46  
**Maximum Parallel Agents:** 6 (Phase 4, Group K)  
**Estimated Total Effort:** 92-184 hours (with parallelization: ~5 weeks)

### 1.2 Timeline

```
Week 1: Foundation & Schema
├─ Day 1-2: Group A (WU-001, WU-003, WU-005) - 3 parallel agents
├─ Day 3-4: Group B (WU-002, WU-004) - 2 parallel agents
└─ Day 5: Group C (WU-006, WU-007) - 2 parallel agents

Week 2: Core Adapters
├─ Day 1-2: Group D (WU-008, WU-009, WU-010) - 3 parallel agents
├─ Day 3-4: Group E (WU-011, WU-012) - 2 parallel agents
├─ Day 4-5: Group F (WU-013, WU-014) - 2 parallel agents
└─ Day 5: Group G (WU-015, WU-016) - 2 parallel agents

Week 3: Sync Engine
├─ Day 1-3: Group H (WU-017, WU-018, WU-019, WU-020, WU-022) - 5 parallel agents
├─ Day 3-4: Group I (WU-021, WU-024, WU-025) - 3 parallel agents
└─ Day 4-5: Group J (WU-023, WU-026) - 2 parallel agents

Week 4: Commands & Validation
├─ Day 1-3: Group K (WU-027, WU-028, WU-030, WU-031, WU-032, WU-033) - 6 parallel agents
├─ Day 3-4: Group L (WU-029) - 1 agent
└─ Day 4-5: Group M (WU-034, WU-035) - 2 parallel agents

Week 5: Testing & Polish
├─ Day 1-2: Group N (WU-036, WU-037, WU-038) - 3 parallel agents
├─ Day 2-3: Group O (WU-039, WU-040, WU-041) - 3 parallel agents
├─ Day 3-4: Group P (WU-042, WU-043, WU-044) - 3 parallel agents
└─ Day 4-5: Group Q (WU-045, WU-046) - 2 parallel agents
```

### 1.3 Deliverables by Phase

**Phase 1 Deliverables:**
- `apps/cli/src/domain/config-v2.types.ts` - TypeScript interfaces
- `apps/cli/src/domain/config-v2.schema.ts` - Zod validators
- `apps/cli/src/core/path-resolver.ts` - Cross-platform path utilities
- `apps/cli/src/core/env-expander.ts` - Environment variable expansion
- `apps/cli/src/core/config-loader.ts` - Config loading with precedence

**Phase 2 Deliverables:**
- `apps/cli/src/adapters/client-adapter.interface.ts` - Abstract adapter interface
- `apps/cli/src/adapters/claude-code-adapter.ts` - Claude Code implementation
- `apps/cli/src/adapters/claude-desktop-adapter.ts` - Claude Desktop implementation
- `apps/cli/src/adapters/adapter-registry.ts` - Adapter registry pattern

**Phase 3 Deliverables:**
- `apps/cli/src/core/sync-engine.ts` - Main sync orchestrator
- `apps/cli/src/core/backup-service.ts` - Backup/restore functionality
- `apps/cli/src/core/process-lock.ts` - Process locking implementation
- `apps/cli/src/core/merge-strategy.ts` - Config merge logic

**Phase 4 Deliverables:**
- `apps/cli/src/commands/user.command.ts` - User config commands
- `apps/cli/src/commands/audit.command.ts` - Audit command
- `apps/cli/src/commands/backup.command.ts` - Backup commands
- Enhanced `sync.command.ts` with multi-client support

**Phase 5 Deliverables:**
- Complete test coverage (unit, integration, E2E)
- Updated documentation (README, schema docs, migration guide)
- Performance benchmarks
- Polished error messages and UX

---

## 2. Dependency Graph

### 2.1 Visual Dependency Map

```
Phase 1: Foundation & Schema
┌─────────────────────────────────────────────────┐
│ Group A (Parallel)                              │
│  ├─ WU-001: Config v2.0 Types                  │
│  ├─ WU-003: Path Resolution Utilities          │
│  └─ WU-005: File Organization Structure        │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group B (Parallel, depends on Group A)         │
│  ├─ WU-002: Zod Schema (depends on WU-001)    │
│  └─ WU-004: Env Var Expansion (depends on WU-001)│
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group C (Parallel, depends on Group B)         │
│  ├─ WU-006: Config Loader (depends on WU-002) │
│  └─ WU-007: Schema Tests (depends on WU-002)   │
└─────────────────────────────────────────────────┘

Phase 2: Core Adapters
┌─────────────────────────────────────────────────┐
│ Group D (Parallel, depends on Phase 1)         │
│  ├─ WU-008: ClientAdapter Interface           │
│  ├─ WU-009: ClientPaths Detection Base        │
│  └─ WU-010: Schema Conversion Utilities        │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group E (Parallel, depends on WU-008)          │
│  ├─ WU-011: ClaudeCodeAdapter                 │
│  └─ WU-012: ClaudeDesktopAdapter              │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group F (Parallel, depends on Group E)         │
│  ├─ WU-013: Adapter Registry                  │
│  └─ WU-014: Client Detection Logic            │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group G (Parallel, depends on Group F)         │
│  ├─ WU-015: Adapter Tests (ClaudeCode)        │
│  └─ WU-016: Adapter Tests (ClaudeDesktop)     │
└─────────────────────────────────────────────────┘

Phase 3: Sync Engine
┌─────────────────────────────────────────────────────────────┐
│ Group H (Parallel, depends on Phase 2)                     │
│  ├─ WU-017: Exclusion System                              │
│  ├─ WU-018: Config Merge Logic                            │
│  ├─ WU-019: Diff Generation                               │
│  ├─ WU-020: Backup Service                                │
│  └─ WU-022: Process Locking                               │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group I (Parallel, depends on Group H)         │
│  ├─ WU-021: Restore Command (depends on WU-020)│
│  ├─ WU-024: Transport Validation              │
│  └─ WU-025: Client-Aware Env Expansion        │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group J (Parallel, depends on Group I)         │
│  ├─ WU-023: Sync Orchestrator (integration)   │
│  └─ WU-026: Sync Engine Tests                 │
└─────────────────────────────────────────────────┘

Phase 4: Commands & Validation
┌─────────────────────────────────────────────────────────────┐
│ Group K (Parallel, depends on Phase 3)                     │
│  ├─ WU-027: overture user init                            │
│  ├─ WU-028: overture user show                            │
│  ├─ WU-030: overture audit                                │
│  ├─ WU-031: overture mcp list (enhanced)                  │
│  ├─ WU-032: overture validate (enhanced)                  │
│  └─ WU-033: overture backup commands                      │
└─────────────────────────────────────────────────────────────┘
         │
         ├──────────────────────────────────┐
         ▼                                  ▼
┌───────────────────────────┐   ┌──────────────────────────┐
│ Group L                   │   │ Group M (Parallel)       │
│  └─ WU-029: overture sync │   │  ├─ WU-034: CLI Tests   │
│     multi-client update   │   │  └─ WU-035: Error Polish│
└───────────────────────────┘   └──────────────────────────┘

Phase 5: Testing & Polish
┌─────────────────────────────────────────────────┐
│ Group N (Parallel, depends on Phase 4)         │
│  ├─ WU-036: Adapter Unit Tests                │
│  ├─ WU-037: Sync Engine Unit Tests            │
│  └─ WU-038: Config Loader Integration Tests   │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group O (Parallel, depends on Group N)         │
│  ├─ WU-039: Multi-Client Sync E2E             │
│  ├─ WU-040: Backup/Restore E2E                │
│  └─ WU-041: Audit Command E2E                 │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group P (Parallel, depends on Group O)         │
│  ├─ WU-042: Documentation (README)            │
│  ├─ WU-043: Documentation (Schema)            │
│  └─ WU-044: Migration Guide                   │
└─────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────┐
│ Group Q (Parallel, depends on Group P)         │
│  ├─ WU-045: Performance Testing               │
│  └─ WU-046: Error Message Polish              │
└─────────────────────────────────────────────────┘
```

### 2.2 Critical Path

The critical path (longest dependency chain) is:

```
WU-001 → WU-002 → WU-006 → WU-008 → WU-011 → WU-013 → 
WU-017 → WU-023 → WU-029 → WU-039 → WU-042 → WU-045
```

**Critical Path Duration:** ~12 work units × 2 hours avg = 24 hours (3 days)

With parallelization, the actual calendar time is ~5 weeks due to dependency blocking.

---

## 3. Work Units (46 Total)

### Phase 1: Foundation & Schema (Week 1)

---

### WU-001: Config v2.0 Type Definitions

**Phase:** 1  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** None  
**Parallel Group:** A

**Description:**
Create TypeScript interfaces for Overture v2.0 configuration schema including user global config structure, MCP-centric design with defaults, client configurations, and transport types.

**Files to Create/Modify:**
- `apps/cli/src/domain/config-v2.types.ts` (create)

**MCP Servers Used:**
- context7: Look up TypeScript best practices for configuration types
- filesystem: Create new file

**Definition of Done:**
- [ ] All v2.0 config types defined (OvertureConfigV2, McpServerConfigV2, ClientConfig, etc.)
- [ ] Transport enum defined ('stdio', 'http', 'sse')
- [ ] Scope enum defined ('global', 'project')
- [ ] JSDoc comments on all types
- [ ] Exports are properly structured

**Memory Entities to Create:**
- Entity Name: "WU-001 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Files: apps/cli/src/domain/config-v2.types.ts"

**Acceptance Criteria:**
- Types compile without errors
- All fields from research doc v2 are represented
- Transport field is mandatory on MCP configs

---

### WU-002: Zod Schema Validators

**Phase:** 1  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** WU-001  
**Parallel Group:** B

**Description:**
Implement Zod schema validators for all v2.0 configuration types with discriminated unions for transport types, validation rules, and helpful error messages.

**Files to Create/Modify:**
- `apps/cli/src/domain/config-v2.schema.ts` (create)

**MCP Servers Used:**
- context7: Look up Zod discriminated union patterns
- filesystem: Create new file

**Definition of Done:**
- [ ] Complete Zod schemas for all v2.0 types
- [ ] Discriminated union for transport types (stdio vs http/sse)
- [ ] Required field validation (transport is required)
- [ ] Environment variable syntax validation (${VAR})
- [ ] Custom error messages for common mistakes
- [ ] Schema parse/safeParse exports

**Memory Entities to Create:**
- Entity Name: "WU-002 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-001"

**Acceptance Criteria:**
- All schemas validate correct configs
- Schemas reject invalid configs with clear errors
- Transport field validation enforces required constraint
- Tests can import and use schemas

---

### WU-003: Path Resolution Utilities

**Phase:** 1  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** None  
**Parallel Group:** A

**Description:**
Implement cross-platform path resolution utilities for user global config (~/.config/overture.yml), platform-specific application directories (Claude Desktop paths), and XDG Base Directory support.

**Files to Create/Modify:**
- `apps/cli/src/core/path-resolver.ts` (create)
- `apps/cli/src/core/path-resolver.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up Node.js path and os modules best practices
- filesystem: Create new files

**Definition of Done:**
- [ ] getUserConfigPath() - Returns ~/.config/overture.yml (XDG compliant)
- [ ] getClaudeCodeGlobalPath() - Returns ~/.claude.json
- [ ] getClaudeDesktopPath() - Platform-specific paths (macOS, Linux, Windows)
- [ ] expandTilde() - Expands ~ to home directory
- [ ] Cross-platform tests (mock process.platform)
- [ ] All functions have JSDoc comments

**Memory Entities to Create:**
- Entity Name: "WU-003 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Functions return correct paths for all platforms
- XDG_CONFIG_HOME environment variable respected
- Tests pass on all platforms (mocked)

---

### WU-004: Environment Variable Expansion

**Phase:** 1  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-001  
**Parallel Group:** B

**Description:**
Implement environment variable expansion logic supporting ${VAR} syntax, ${VAR:-default} default values, recursive expansion, and validation.

**Files to Create/Modify:**
- `apps/cli/src/core/env-expander.ts` (create)
- `apps/cli/src/core/env-expander.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up environment variable expansion patterns
- filesystem: Create new files

**Definition of Done:**
- [ ] expandEnvVars(str: string) - Main expansion function
- [ ] Supports ${VAR} syntax
- [ ] Supports ${VAR:-default} default values
- [ ] Handles missing variables gracefully (leave unexpanded or use default)
- [ ] Recursive expansion support (${VAR} contains ${OTHER_VAR})
- [ ] Comprehensive tests with various edge cases
- [ ] Documentation on expansion behavior

**Memory Entities to Create:**
- Entity Name: "WU-004 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-001"

**Acceptance Criteria:**
- Expansion handles all documented syntax variants
- Missing variables handled according to spec
- Tests cover edge cases (empty vars, circular refs, etc.)

---

### WU-005: File Organization Structure

**Phase:** 1  
**Agent:** backend-architect  
**Estimated Time:** 1 hour  
**Dependencies:** None  
**Parallel Group:** A

**Description:**
Create directory structure for v2.0 codebase including adapters/, core/, domain/, utils/, and establish file naming conventions.

**Files to Create/Modify:**
- `apps/cli/src/adapters/.gitkeep` (create)
- `apps/cli/src/core/.gitkeep` (create - may already exist)
- `apps/cli/src/domain/.gitkeep` (create - may already exist)
- `apps/cli/src/utils/.gitkeep` (create)
- `docs/v0.2-architecture.md` (create)

**MCP Servers Used:**
- filesystem: Create directory structure
- memory: Document architectural decisions

**Definition of Done:**
- [ ] Directory structure created
- [ ] Architecture doc explains organization
- [ ] Naming conventions documented
- [ ] README.md in each directory explaining purpose

**Memory Entities to Create:**
- Entity Name: "WU-005 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: backend-architect"
- Entity Name: "Architecture Decision: Directory Structure"
  - Observation: "Adapters in src/adapters/ for client-specific logic"
  - Observation: "Core business logic in src/core/"
  - Observation: "Domain types and schemas in src/domain/"

**Acceptance Criteria:**
- All directories exist and are documented
- Architecture doc is clear and comprehensive

---

### WU-006: Config Loader with Precedence

**Phase:** 1  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** WU-002, WU-003, WU-004  
**Parallel Group:** C

**Description:**
Implement configuration loader that reads user global and project configs, applies precedence rules (project overrides user), validates with Zod schemas, and expands environment variables.

**Files to Create/Modify:**
- `apps/cli/src/core/config-loader.ts` (create)
- `apps/cli/src/core/config-loader.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up configuration merging patterns
- filesystem: Create new files

**Definition of Done:**
- [ ] loadUserConfig() - Load ~/.config/overture.yml
- [ ] loadProjectConfig() - Load .overture/config.yaml
- [ ] mergeConfigs() - Apply precedence rules
- [ ] Validate configs with Zod schemas
- [ ] Expand environment variables
- [ ] Handle missing files gracefully
- [ ] Comprehensive tests for precedence logic

**Memory Entities to Create:**
- Entity Name: "WU-006 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-002, WU-003, WU-004"

**Acceptance Criteria:**
- Config loader reads both user and project configs
- Precedence rules correctly applied (project wins)
- Invalid configs produce helpful error messages
- Tests cover all precedence scenarios

---

### WU-007: Schema Validation Tests

**Phase:** 1  
**Agent:** test-automator  
**Estimated Time:** 2 hours  
**Dependencies:** WU-002  
**Parallel Group:** C

**Description:**
Create comprehensive test suite for Zod schemas covering valid configs, invalid configs, edge cases, and error messages.

**Files to Create/Modify:**
- `apps/cli/src/domain/config-v2.schema.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up Jest/Zod testing patterns
- filesystem: Create test file

**Definition of Done:**
- [ ] Tests for all valid config variations
- [ ] Tests for all invalid config variations
- [ ] Tests for required field validation (transport)
- [ ] Tests for environment variable syntax validation
- [ ] Tests for enum validation (transport, scope)
- [ ] Tests verify error message clarity
- [ ] 100% coverage of schema file

**Memory Entities to Create:**
- Entity Name: "WU-007 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"
  - Observation: "Depends on: WU-002"

**Acceptance Criteria:**
- All tests pass
- Test coverage is 100% for schema file
- Edge cases are covered

---

### Phase 2: Core Adapters (Week 2)

---

### WU-008: ClientAdapter Interface

**Phase:** 2  
**Agent:** backend-architect  
**Estimated Time:** 2 hours  
**Dependencies:** WU-001  
**Parallel Group:** D

**Description:**
Define abstract ClientAdapter interface specifying methods for path detection, schema conversion, capability queries, validation, read/write, and merge.

**Files to Create/Modify:**
- `apps/cli/src/adapters/client-adapter.interface.ts` (create)
- `apps/cli/src/adapters/types.ts` (create)

**MCP Servers Used:**
- context7: Look up adapter pattern best practices
- filesystem: Create new files

**Definition of Done:**
- [ ] ClientAdapter interface defined with all methods
- [ ] ClientPaths type defined
- [ ] ClientConfig type defined
- [ ] ValidationResult type defined
- [ ] Transport[] type defined
- [ ] Clear JSDoc documentation for all methods
- [ ] Examples in comments

**Memory Entities to Create:**
- Entity Name: "WU-008 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: backend-architect"
  - Observation: "Depends on: WU-001"
- Entity Name: "Architecture Decision: Adapter Pattern"
  - Observation: "ClientAdapter interface isolates client-specific logic"
  - Observation: "Each client gets its own adapter implementation"

**Acceptance Criteria:**
- Interface compiles without errors
- All methods have clear contracts
- Documentation explains adapter pattern

---

### WU-009: ClientPaths Detection Base

**Phase:** 2  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-003, WU-008  
**Parallel Group:** D

**Description:**
Implement base functionality for detecting client configuration paths across platforms using path resolver utilities.

**Files to Create/Modify:**
- `apps/cli/src/adapters/path-detector.ts` (create)
- `apps/cli/src/adapters/path-detector.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] detectClaudeCodePaths() function
- [ ] detectClaudeDesktopPaths() function
- [ ] Platform-specific logic (Windows, macOS, Linux)
- [ ] File existence checks
- [ ] Tests for all platforms (mocked)

**Memory Entities to Create:**
- Entity Name: "WU-009 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-003, WU-008"

**Acceptance Criteria:**
- Path detection works for all supported clients
- Tests cover all platforms
- Non-existent paths handled gracefully

---

### WU-010: Schema Conversion Utilities

**Phase:** 2  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-001, WU-008  
**Parallel Group:** D

**Description:**
Implement utilities for converting between Overture schema and client-specific schemas (mcpServers vs servers, adding type field, etc.).

**Files to Create/Modify:**
- `apps/cli/src/adapters/schema-converter.ts` (create)
- `apps/cli/src/adapters/schema-converter.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] convertToStandardSchema() - Overture → mcpServers format
- [ ] convertToVSCodeSchema() - Overture → servers format with type field
- [ ] addTransportField() - Add type field for VS Code
- [ ] removeTransportField() - Remove type field for other clients
- [ ] Tests for all conversion scenarios

**Memory Entities to Create:**
- Entity Name: "WU-010 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-001, WU-008"

**Acceptance Criteria:**
- Conversions are lossless
- All client schema formats supported
- Tests verify correctness

---

### WU-011: ClaudeCodeAdapter Implementation

**Phase:** 2  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** WU-008, WU-009, WU-010  
**Parallel Group:** E

**Description:**
Implement ClaudeCodeAdapter class with all interface methods for global (~/.claude.json) and project (.mcp.json) configurations.

**Files to Create/Modify:**
- `apps/cli/src/adapters/claude-code-adapter.ts` (create)

**MCP Servers Used:**
- context7: Look up Claude Code configuration format
- filesystem: Create new file

**Definition of Done:**
- [ ] Implements ClientAdapter interface
- [ ] detectConfigPaths() returns global + project paths
- [ ] convertToClientSchema() generates mcpServers format
- [ ] supportsEnvExpansion() returns true
- [ ] supportedTransports() returns ['stdio', 'http', 'sse']
- [ ] requiresRestart() returns false
- [ ] validate() checks schema correctness
- [ ] readConfig() and writeConfig() implemented
- [ ] mergeConfigs() applies precedence

**Memory Entities to Create:**
- Entity Name: "WU-011 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-008, WU-009, WU-010"

**Acceptance Criteria:**
- Adapter implements all interface methods
- Methods behave according to spec
- Code is well-documented

---

### WU-012: ClaudeDesktopAdapter Implementation

**Phase:** 2  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** WU-008, WU-009, WU-010  
**Parallel Group:** E

**Description:**
Implement ClaudeDesktopAdapter class extending ClaudeCodeAdapter with platform-specific paths and transport limitations.

**Files to Create/Modify:**
- `apps/cli/src/adapters/claude-desktop-adapter.ts` (create)

**MCP Servers Used:**
- context7: Look up Claude Desktop configuration format
- filesystem: Create new file

**Definition of Done:**
- [ ] Extends ClaudeCodeAdapter (schema reuse)
- [ ] detectConfigPaths() returns platform-specific path
- [ ] supportsEnvExpansion() returns false (needs testing)
- [ ] supportedTransports() checks if paid tier (stdio vs all)
- [ ] requiresRestart() returns true
- [ ] Overrides necessary methods for Claude Desktop specifics
- [ ] Documentation on free vs paid tier handling

**Memory Entities to Create:**
- Entity Name: "WU-012 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-008, WU-009, WU-010"

**Acceptance Criteria:**
- Adapter implements all interface methods
- Platform-specific paths correct for all OS
- Transport limitations documented

---

### WU-013: Adapter Registry Pattern

**Phase:** 2  
**Agent:** backend-architect  
**Estimated Time:** 2 hours  
**Dependencies:** WU-011, WU-012  
**Parallel Group:** F

**Description:**
Implement adapter registry for registering, retrieving, and auto-detecting installed clients.

**Files to Create/Modify:**
- `apps/cli/src/adapters/adapter-registry.ts` (create)
- `apps/cli/src/adapters/adapter-registry.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up registry pattern implementations
- filesystem: Create new files

**Definition of Done:**
- [ ] AdapterRegistry class
- [ ] register(adapter: ClientAdapter) method
- [ ] get(name: string) method
- [ ] all() method
- [ ] detect() method - Auto-detect installed clients
- [ ] Singleton pattern or factory
- [ ] Tests for registry operations

**Memory Entities to Create:**
- Entity Name: "WU-013 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: backend-architect"
  - Observation: "Depends on: WU-011, WU-012"

**Acceptance Criteria:**
- Registry manages all adapters
- detect() finds installed clients
- Tests verify registry behavior

---

### WU-014: Client Detection Logic

**Phase:** 2  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-013  
**Parallel Group:** F

**Description:**
Implement logic to detect which AI clients are installed on the system by checking config file existence.

**Files to Create/Modify:**
- `apps/cli/src/core/client-detector.ts` (create)
- `apps/cli/src/core/client-detector.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] detectInstalledClients() function
- [ ] Uses adapter registry to check each client
- [ ] Returns list of detected clients
- [ ] Checks file existence without reading
- [ ] Fast execution (parallel checks)
- [ ] Tests with mocked filesystem

**Memory Entities to Create:**
- Entity Name: "WU-014 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-013"

**Acceptance Criteria:**
- Detection is fast and accurate
- Works across all platforms
- Tests verify detection logic

---

### WU-015: Adapter Tests (ClaudeCode)

**Phase:** 2  
**Agent:** test-automator  
**Estimated Time:** 2 hours  
**Dependencies:** WU-011, WU-013  
**Parallel Group:** G

**Description:**
Create comprehensive test suite for ClaudeCodeAdapter covering all methods and edge cases.

**Files to Create/Modify:**
- `apps/cli/src/adapters/claude-code-adapter.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up adapter testing patterns
- filesystem: Create test file

**Definition of Done:**
- [ ] Tests for all adapter methods
- [ ] Tests for global + project config scenarios
- [ ] Tests for schema conversion
- [ ] Tests for validation
- [ ] Tests for merge logic
- [ ] Mock filesystem for tests
- [ ] 100% coverage of adapter file

**Memory Entities to Create:**
- Entity Name: "WU-015 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"
  - Observation: "Depends on: WU-011, WU-013"

**Acceptance Criteria:**
- All tests pass
- Test coverage is 100%
- Edge cases covered

---

### WU-016: Adapter Tests (ClaudeDesktop)

**Phase:** 2  
**Agent:** test-automator  
**Estimated Time:** 2 hours  
**Dependencies:** WU-012, WU-013  
**Parallel Group:** G

**Description:**
Create comprehensive test suite for ClaudeDesktopAdapter covering platform-specific paths and transport limitations.

**Files to Create/Modify:**
- `apps/cli/src/adapters/claude-desktop-adapter.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up platform-specific testing patterns
- filesystem: Create test file

**Definition of Done:**
- [ ] Tests for all platforms (Windows, macOS, Linux)
- [ ] Tests for path detection
- [ ] Tests for transport limitations (free vs paid)
- [ ] Tests for restart requirement
- [ ] Mock filesystem and platform
- [ ] 100% coverage of adapter file

**Memory Entities to Create:**
- Entity Name: "WU-016 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"
  - Observation: "Depends on: WU-012, WU-013"

**Acceptance Criteria:**
- All tests pass
- Test coverage is 100%
- Platform differences tested

---

### Phase 3: Sync Engine (Week 3)

---

### WU-017: Exclusion System

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-011, WU-012  
**Parallel Group:** H

**Description:**
Implement MCP exclusion system to filter which MCPs go to which clients based on include/exclude rules.

**Files to Create/Modify:**
- `apps/cli/src/core/exclusion-filter.ts` (create)
- `apps/cli/src/core/exclusion-filter.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] filterMcpsForClient() function
- [ ] Handles include/exclude rules
- [ ] Handles default clients from config
- [ ] Respects client capabilities (transport)
- [ ] Tests for various exclusion scenarios

**Memory Entities to Create:**
- Entity Name: "WU-017 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Filtering logic is correct
- All rule types supported
- Tests verify behavior

---

### WU-018: Config Merge Logic

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** WU-006  
**Parallel Group:** H

**Description:**
Implement configuration merge strategy for combining user global and project configs with deduplication.

**Files to Create/Modify:**
- `apps/cli/src/core/merge-strategy.ts` (create)
- `apps/cli/src/core/merge-strategy.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up configuration merge patterns
- filesystem: Create new files

**Definition of Done:**
- [ ] mergeUserAndProjectConfigs() function
- [ ] Deduplicates global MCPs (project references only)
- [ ] Project settings override user settings
- [ ] Plugin precedence handled correctly
- [ ] Tests for complex merge scenarios

**Memory Entities to Create:**
- Entity Name: "WU-018 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-006"

**Acceptance Criteria:**
- Merge logic is correct and tested
- Deduplication works properly
- Precedence rules applied correctly

---

### WU-019: Diff Generation

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-010  
**Parallel Group:** H

**Description:**
Implement config diff generation to show users what will change before syncing.

**Files to Create/Modify:**
- `apps/cli/src/core/config-diff.ts` (create)
- `apps/cli/src/core/config-diff.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up diff algorithm patterns
- filesystem: Create new files

**Definition of Done:**
- [ ] generateDiff() function
- [ ] Detects added MCPs
- [ ] Detects modified MCPs (with field-level changes)
- [ ] Detects removed MCPs
- [ ] Pretty-print diff output
- [ ] Tests for diff generation

**Memory Entities to Create:**
- Entity Name: "WU-019 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Diff accurately shows changes
- Output is human-readable
- Tests verify correctness

---

### WU-020: Backup Service

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** None (parallel with other Group H)  
**Parallel Group:** H

**Description:**
Implement backup service to save client configs before modifications with timestamped backups and retention policy.

**Files to Create/Modify:**
- `apps/cli/src/core/backup-service.ts` (create)
- `apps/cli/src/core/backup-service.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] backupClientConfig() function
- [ ] Saves to ~/.config/overture/backups/{client}-{timestamp}.json
- [ ] Retention policy (keep last 10 backups per client)
- [ ] listBackups() function
- [ ] Automatic cleanup of old backups
- [ ] Tests for backup operations

**Memory Entities to Create:**
- Entity Name: "WU-020 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Backups are created successfully
- Retention policy works
- Old backups are cleaned up
- Tests verify behavior

---

### WU-021: Restore Command

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-020  
**Parallel Group:** I

**Description:**
Implement restore functionality to recover previous client configurations from backups.

**Files to Create/Modify:**
- `apps/cli/src/core/restore-service.ts` (create)
- `apps/cli/src/core/restore-service.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] restoreBackup() function
- [ ] Accepts client name and timestamp
- [ ] Restores to client config path
- [ ] Validates backup before restore
- [ ] Tests for restore operations

**Memory Entities to Create:**
- Entity Name: "WU-021 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-020"

**Acceptance Criteria:**
- Restore works correctly
- Invalid backups rejected
- Tests verify behavior

---

### WU-022: Process Locking

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** None (parallel with other Group H)  
**Parallel Group:** H

**Description:**
Implement process locking to prevent concurrent sync operations using file-based locks.

**Files to Create/Modify:**
- `apps/cli/src/core/process-lock.ts` (create)
- `apps/cli/src/core/process-lock.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up file locking libraries (proper-lockfile)
- filesystem: Create new files

**Definition of Done:**
- [ ] acquireLock() function
- [ ] releaseLock() function
- [ ] Uses ~/.config/overture/.lock
- [ ] Stale lock detection (10s timeout)
- [ ] Retry mechanism with backoff
- [ ] Clear error messages for lock conflicts
- [ ] Tests with mocked locks

**Memory Entities to Create:**
- Entity Name: "WU-022 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Locking prevents concurrent operations
- Stale locks handled
- Tests verify behavior

---

### WU-023: Sync Orchestrator

**Phase:** 3  
**Agent:** backend-architect  
**Estimated Time:** 4 hours  
**Dependencies:** WU-017, WU-018, WU-019, WU-020, WU-022  
**Parallel Group:** J

**Description:**
Implement main sync orchestration logic coordinating all sync operations: load configs, filter MCPs, backup, convert schemas, write configs.

**Files to Create/Modify:**
- `apps/cli/src/core/sync-engine.ts` (create)

**MCP Servers Used:**
- memory: Document sync workflow
- filesystem: Create new file

**Definition of Done:**
- [ ] syncAllClients() function
- [ ] Coordinates: lock → load → filter → backup → convert → write → unlock
- [ ] Error handling at each step
- [ ] Rollback on failure
- [ ] Progress reporting
- [ ] Dry-run mode support

**Memory Entities to Create:**
- Entity Name: "WU-023 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: backend-architect"
  - Observation: "Depends on: WU-017, WU-018, WU-019, WU-020, WU-022"
- Entity Name: "Architecture Decision: Sync Orchestration"
  - Observation: "Sync engine coordinates all operations with rollback support"

**Acceptance Criteria:**
- Orchestration coordinates all steps
- Error handling is robust
- Rollback works on failure

---

### WU-024: Transport Validation

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-011, WU-012  
**Parallel Group:** I

**Description:**
Implement transport validation to ensure MCPs use transports supported by target clients.

**Files to Create/Modify:**
- `apps/cli/src/core/transport-validator.ts` (create)
- `apps/cli/src/core/transport-validator.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] validateTransport() function
- [ ] Checks transport against client capabilities
- [ ] Warns on unsupported transports
- [ ] Filters MCPs with unsupported transports
- [ ] Tests for all client/transport combinations

**Memory Entities to Create:**
- Entity Name: "WU-024 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Validation correctly identifies unsupported transports
- Warnings are clear
- Tests cover all scenarios

---

### WU-025: Client-Aware Env Expansion

**Phase:** 3  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-004, WU-011, WU-012  
**Parallel Group:** I

**Description:**
Implement client-aware environment variable expansion that expands variables for clients that don't support ${VAR} syntax natively.

**Files to Create/Modify:**
- `apps/cli/src/core/client-env-expander.ts` (create)
- `apps/cli/src/core/client-env-expander.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] expandForClient() function
- [ ] Checks adapter.supportsEnvExpansion()
- [ ] Expands variables if not supported (VS Code)
- [ ] Leaves ${VAR} syntax if supported (Claude Code)
- [ ] Tests for each client type

**Memory Entities to Create:**
- Entity Name: "WU-025 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-004, WU-011, WU-012"

**Acceptance Criteria:**
- Expansion respects client capabilities
- Tests verify correct behavior per client

---

### WU-026: Sync Engine Tests

**Phase:** 3  
**Agent:** test-automator  
**Estimated Time:** 3 hours  
**Dependencies:** WU-023  
**Parallel Group:** J

**Description:**
Create comprehensive test suite for sync orchestrator covering success paths, error paths, and rollback scenarios.

**Files to Create/Modify:**
- `apps/cli/src/core/sync-engine.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up orchestration testing patterns
- filesystem: Create test file

**Definition of Done:**
- [ ] Tests for successful sync
- [ ] Tests for partial failures
- [ ] Tests for rollback
- [ ] Tests for dry-run mode
- [ ] Mock all dependencies
- [ ] 100% coverage of sync engine

**Memory Entities to Create:**
- Entity Name: "WU-026 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"
  - Observation: "Depends on: WU-023"

**Acceptance Criteria:**
- All tests pass
- Test coverage is 100%
- Error scenarios covered

---

### Phase 4: Commands & Validation (Week 4)

---

### WU-027: overture user init Command

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-006  
**Parallel Group:** K

**Description:**
Implement `overture user init` command to initialize user global configuration with interactive prompts.

**Files to Create/Modify:**
- `apps/cli/src/commands/user.command.ts` (create)
- `apps/cli/src/commands/user.command.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up Commander.js command patterns
- filesystem: Create new files

**Definition of Done:**
- [ ] `overture user init` command
- [ ] Interactive prompts for common settings
- [ ] Creates ~/.config/overture.yml if not exists
- [ ] Validates and writes config
- [ ] Help text and examples
- [ ] Tests for command execution

**Memory Entities to Create:**
- Entity Name: "WU-027 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Command creates valid config
- Prompts are user-friendly
- Tests verify behavior

---

### WU-028: overture user show Command

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 1 hour  
**Dependencies:** WU-006  
**Parallel Group:** K

**Description:**
Implement `overture user show` command to display current user global configuration.

**Files to Create/Modify:**
- `apps/cli/src/commands/user.command.ts` (modify)
- `apps/cli/src/commands/user.command.spec.ts` (modify)

**MCP Servers Used:**
- filesystem: Modify files

**Definition of Done:**
- [ ] `overture user show` command
- [ ] Pretty-prints user config
- [ ] Shows which MCPs are global
- [ ] Shows which clients are enabled
- [ ] Tests for command execution

**Memory Entities to Create:**
- Entity Name: "WU-028 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Command displays config clearly
- Output is formatted nicely
- Tests verify behavior

---

### WU-029: overture sync Multi-Client Update

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-023  
**Parallel Group:** L

**Description:**
Update existing `overture sync` command to use new sync engine with multi-client support.

**Files to Create/Modify:**
- `apps/cli/src/commands/sync.command.ts` (modify)

**MCP Servers Used:**
- filesystem: Modify file

**Definition of Done:**
- [ ] Integrates with sync orchestrator (WU-023)
- [ ] Supports --dry-run flag
- [ ] Supports --client flag to sync specific clients
- [ ] Shows progress and results per client
- [ ] Updated help text

**Memory Entities to Create:**
- Entity Name: "WU-029 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
  - Observation: "Depends on: WU-023"

**Acceptance Criteria:**
- Command uses new sync engine
- Multi-client sync works
- Flags work as expected

---

### WU-030: overture audit Command

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** WU-013, WU-014  
**Parallel Group:** K

**Description:**
Implement `overture audit` command to detect user-managed MCPs not in Overture config.

**Files to Create/Modify:**
- `apps/cli/src/commands/audit.command.ts` (create)
- `apps/cli/src/core/audit-service.ts` (create)
- `apps/cli/src/commands/audit.command.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up audit pattern implementations
- filesystem: Create new files

**Definition of Done:**
- [ ] `overture audit` command
- [ ] Reads all client configs
- [ ] Compares with Overture config
- [ ] Reports Overture-managed vs user-managed MCPs
- [ ] Suggestions for consolidation
- [ ] Tests for audit logic

**Memory Entities to Create:**
- Entity Name: "WU-030 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Audit detects unmanaged MCPs
- Output is clear and actionable
- Tests verify behavior

---

### WU-031: overture mcp list Enhancements

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-006, WU-017  
**Parallel Group:** K

**Description:**
Enhance existing `overture mcp list` command to show global vs project MCPs and which clients receive each MCP.

**Files to Create/Modify:**
- `apps/cli/src/commands/mcp.command.ts` (modify)

**MCP Servers Used:**
- filesystem: Modify file

**Definition of Done:**
- [ ] Shows scope (global vs project)
- [ ] Shows which clients each MCP syncs to
- [ ] Shows transport type
- [ ] Shows enabled/disabled status
- [ ] Filters by scope (--global, --project)
- [ ] Updated tests

**Memory Entities to Create:**
- Entity Name: "WU-031 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Command shows comprehensive MCP info
- Filters work correctly
- Tests verify behavior

---

### WU-032: overture validate Enhancements

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-024  
**Parallel Group:** K

**Description:**
Enhance existing `overture validate` command to validate transport support and config v2.0 schema.

**Files to Create/Modify:**
- `apps/cli/src/commands/validate.command.ts` (modify)

**MCP Servers Used:**
- filesystem: Modify file

**Definition of Done:**
- [ ] Validates v2.0 schema
- [ ] Validates transport compatibility
- [ ] Validates required fields
- [ ] Clear error messages
- [ ] Warnings for potential issues
- [ ] Updated tests

**Memory Entities to Create:**
- Entity Name: "WU-032 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Validation catches common errors
- Error messages are helpful
- Tests verify behavior

---

### WU-033: overture backup Commands

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-020, WU-021  
**Parallel Group:** K

**Description:**
Implement `overture backup` command group for listing and restoring backups.

**Files to Create/Modify:**
- `apps/cli/src/commands/backup.command.ts` (create)
- `apps/cli/src/commands/backup.command.spec.ts` (create)

**MCP Servers Used:**
- filesystem: Create new files

**Definition of Done:**
- [ ] `overture backup list` command
- [ ] `overture backup restore` command
- [ ] Support --client flag
- [ ] Support --timestamp flag
- [ ] Support --latest flag
- [ ] Tests for commands

**Memory Entities to Create:**
- Entity Name: "WU-033 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Backup commands work correctly
- Restore is safe and validated
- Tests verify behavior

---

### WU-034: CLI Integration Tests

**Phase:** 4  
**Agent:** test-automator  
**Estimated Time:** 3 hours  
**Dependencies:** WU-027, WU-028, WU-029, WU-030, WU-031, WU-032, WU-033  
**Parallel Group:** M

**Description:**
Create integration tests for CLI commands testing end-to-end command execution.

**Files to Create/Modify:**
- `apps/cli/src/commands/integration.spec.ts` (create)

**MCP Servers Used:**
- context7: Look up CLI integration testing patterns
- filesystem: Create test file

**Definition of Done:**
- [ ] Tests for all new commands
- [ ] Tests use real CLI invocation (not unit tests)
- [ ] Mock filesystem for test isolation
- [ ] Tests verify command output
- [ ] Tests verify side effects (file creation)

**Memory Entities to Create:**
- Entity Name: "WU-034 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"

**Acceptance Criteria:**
- Integration tests pass
- Commands work end-to-end
- Output is verified

---

### WU-035: Error Handling Improvements

**Phase:** 4  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-029  
**Parallel Group:** M

**Description:**
Improve error handling and messages across all commands with user-friendly error messages and suggestions.

**Files to Create/Modify:**
- `apps/cli/src/core/error-handler.ts` (create)
- Multiple command files (modify)

**MCP Servers Used:**
- filesystem: Create and modify files

**Definition of Done:**
- [ ] Centralized error handler
- [ ] User-friendly error messages
- [ ] Suggestions for common errors
- [ ] Error codes for programmatic handling
- [ ] Consistent error format
- [ ] Tests for error scenarios

**Memory Entities to Create:**
- Entity Name: "WU-035 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Error messages are clear and helpful
- Errors suggest solutions
- Tests verify error handling

---

### Phase 5: Testing & Polish (Week 5)

---

### WU-036: Adapter Unit Tests (Complete Coverage)

**Phase:** 5  
**Agent:** test-automator  
**Estimated Time:** 3 hours  
**Dependencies:** WU-015, WU-016  
**Parallel Group:** N

**Description:**
Ensure 100% test coverage for all adapter code including edge cases and error scenarios.

**Files to Create/Modify:**
- Multiple adapter test files (modify)

**MCP Servers Used:**
- filesystem: Modify test files

**Definition of Done:**
- [ ] 100% line coverage for all adapters
- [ ] 100% branch coverage for all adapters
- [ ] Edge cases tested
- [ ] Error scenarios tested
- [ ] Coverage report generated

**Memory Entities to Create:**
- Entity Name: "WU-036 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"

**Acceptance Criteria:**
- Test coverage is 100%
- All edge cases covered
- Coverage report shows green

---

### WU-037: Sync Engine Unit Tests (Complete Coverage)

**Phase:** 5  
**Agent:** test-automator  
**Estimated Time:** 3 hours  
**Dependencies:** WU-026  
**Parallel Group:** N

**Description:**
Ensure 100% test coverage for sync engine and related services.

**Files to Create/Modify:**
- Multiple sync engine test files (modify)

**MCP Servers Used:**
- filesystem: Modify test files

**Definition of Done:**
- [ ] 100% line coverage for sync engine
- [ ] 100% branch coverage for sync engine
- [ ] All services tested
- [ ] Error scenarios tested
- [ ] Coverage report generated

**Memory Entities to Create:**
- Entity Name: "WU-037 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"

**Acceptance Criteria:**
- Test coverage is 100%
- All scenarios covered
- Coverage report shows green

---

### WU-038: Config Loader Integration Tests

**Phase:** 5  
**Agent:** test-automator  
**Estimated Time:** 2 hours  
**Dependencies:** WU-006  
**Parallel Group:** N

**Description:**
Create integration tests for config loading with real YAML files and precedence scenarios.

**Files to Create/Modify:**
- `apps/cli/src/core/config-loader.integration.spec.ts` (create)
- Test fixture files (create)

**MCP Servers Used:**
- filesystem: Create test files and fixtures

**Definition of Done:**
- [ ] Tests with real YAML files
- [ ] Tests for user + project precedence
- [ ] Tests for invalid YAML
- [ ] Tests for missing files
- [ ] Tests for environment variables

**Memory Entities to Create:**
- Entity Name: "WU-038 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"

**Acceptance Criteria:**
- Integration tests pass
- Real files tested
- Precedence verified

---

### WU-039: Multi-Client Sync E2E Tests

**Phase:** 5  
**Agent:** test-automator  
**Estimated Time:** 4 hours  
**Dependencies:** WU-029, WU-036, WU-037  
**Parallel Group:** O

**Description:**
Create end-to-end tests for multi-client sync scenarios using apps/cli-e2e framework.

**Files to Create/Modify:**
- `apps/cli-e2e/src/sync-multi-client.spec.ts` (create)
- Test fixtures and mocks

**MCP Servers Used:**
- nx: Use nx test framework
- filesystem: Create test files

**Definition of Done:**
- [ ] E2E test for syncing to Claude Code
- [ ] E2E test for syncing to Claude Desktop
- [ ] E2E test for syncing to both simultaneously
- [ ] E2E test for exclusion rules
- [ ] E2E test for dry-run mode
- [ ] Tests use real CLI binary

**Memory Entities to Create:**
- Entity Name: "WU-039 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"

**Acceptance Criteria:**
- E2E tests pass
- Real CLI tested
- Multi-client scenarios verified

---

### WU-040: Backup/Restore E2E Tests

**Phase:** 5  
**Agent:** test-automator  
**Estimated Time:** 2 hours  
**Dependencies:** WU-033  
**Parallel Group:** O

**Description:**
Create end-to-end tests for backup and restore functionality.

**Files to Create/Modify:**
- `apps/cli-e2e/src/backup-restore.spec.ts` (create)

**MCP Servers Used:**
- nx: Use nx test framework
- filesystem: Create test files

**Definition of Done:**
- [ ] E2E test for creating backups
- [ ] E2E test for listing backups
- [ ] E2E test for restoring backups
- [ ] E2E test for retention policy
- [ ] Tests use real CLI binary

**Memory Entities to Create:**
- Entity Name: "WU-040 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"

**Acceptance Criteria:**
- E2E tests pass
- Backup/restore works end-to-end
- Retention policy verified

---

### WU-041: Audit Command E2E Tests

**Phase:** 5  
**Agent:** test-automator  
**Estimated Time:** 2 hours  
**Dependencies:** WU-030  
**Parallel Group:** O

**Description:**
Create end-to-end tests for audit command functionality.

**Files to Create/Modify:**
- `apps/cli-e2e/src/audit.spec.ts` (create)

**MCP Servers Used:**
- nx: Use nx test framework
- filesystem: Create test files

**Definition of Done:**
- [ ] E2E test for detecting unmanaged MCPs
- [ ] E2E test for audit output format
- [ ] E2E test with multiple clients
- [ ] Tests use real CLI binary

**Memory Entities to Create:**
- Entity Name: "WU-041 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: test-automator"

**Acceptance Criteria:**
- E2E tests pass
- Audit detection works correctly
- Output is verified

---

### WU-042: Documentation (README)

**Phase:** 5  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-029  
**Parallel Group:** P

**Description:**
Update README.md with v0.2 features, commands, and usage examples.

**Files to Create/Modify:**
- `README.md` (modify)

**MCP Servers Used:**
- filesystem: Modify file

**Definition of Done:**
- [ ] Overview section updated
- [ ] New commands documented
- [ ] User global config explained
- [ ] Multi-client sync examples
- [ ] Migration section added
- [ ] Screenshots/examples added

**Memory Entities to Create:**
- Entity Name: "WU-042 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- README is comprehensive
- Examples are clear
- All features documented

---

### WU-043: Documentation (Schema)

**Phase:** 5  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-001, WU-002  
**Parallel Group:** P

**Description:**
Update schema documentation with v2.0 config format.

**Files to Create/Modify:**
- `docs/overture-schema.md` (modify)
- `docs/config-v2-examples.md` (create)

**MCP Servers Used:**
- filesystem: Modify and create files

**Definition of Done:**
- [ ] Schema v2.0 fully documented
- [ ] All fields explained
- [ ] Examples for common scenarios
- [ ] Transport field documented as required
- [ ] Environment variable syntax documented

**Memory Entities to Create:**
- Entity Name: "WU-043 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Schema docs are complete
- Examples are helpful
- Required fields clearly marked

---

### WU-044: Migration Guide

**Phase:** 5  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-042  
**Parallel Group:** P

**Description:**
Create migration guide for users upgrading from v0.1 to v0.2.

**Files to Create/Modify:**
- `docs/migration-v0.1-to-v0.2.md` (create)

**MCP Servers Used:**
- filesystem: Create file

**Definition of Done:**
- [ ] Breaking changes documented
- [ ] Step-by-step migration instructions
- [ ] Config conversion examples
- [ ] Common issues and solutions
- [ ] Benefits of upgrading explained

**Memory Entities to Create:**
- Entity Name: "WU-044 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Migration path is clear
- All breaking changes documented
- Examples are provided

---

### WU-045: Performance Testing

**Phase:** 5  
**Agent:** typescript-pro  
**Estimated Time:** 3 hours  
**Dependencies:** WU-039  
**Parallel Group:** Q

**Description:**
Create performance tests and benchmarks for sync operations.

**Files to Create/Modify:**
- `apps/cli/src/performance/sync-benchmark.spec.ts` (create)

**MCP Servers Used:**
- nx: Use nx test framework
- filesystem: Create test files

**Definition of Done:**
- [ ] Benchmark for sync with 10 MCPs
- [ ] Benchmark for sync with 50 MCPs
- [ ] Benchmark for sync with 100 MCPs
- [ ] Benchmark for multiple clients
- [ ] Performance regression tests
- [ ] Results documented

**Memory Entities to Create:**
- Entity Name: "WU-045 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"
- Entity Name: "Performance Metrics"
  - Observation: "Sync 10 MCPs: X ms"
  - Observation: "Sync 50 MCPs: Y ms"
  - Observation: "Sync 100 MCPs: Z ms"

**Acceptance Criteria:**
- Benchmarks run successfully
- Performance is acceptable
- Metrics documented

---

### WU-046: Error Message Polish

**Phase:** 5  
**Agent:** typescript-pro  
**Estimated Time:** 2 hours  
**Dependencies:** WU-035  
**Parallel Group:** Q

**Description:**
Review and polish all error messages for clarity, consistency, and helpfulness.

**Files to Create/Modify:**
- Multiple command and service files (modify)

**MCP Servers Used:**
- filesystem: Modify files

**Definition of Done:**
- [ ] All error messages reviewed
- [ ] Consistent error format
- [ ] Helpful suggestions added
- [ ] Error codes assigned
- [ ] Documentation of error codes

**Memory Entities to Create:**
- Entity Name: "WU-046 Status"
  - Observation: "Status: [pending|in-progress|completed]"
  - Observation: "Agent: typescript-pro"

**Acceptance Criteria:**
- Error messages are user-friendly
- Format is consistent
- Suggestions are helpful

---

## 4. Parallel Execution Strategy

### 4.1 Parallel Groups Summary

| Group | Phase | Work Units | Max Parallel Agents | Duration |
|-------|-------|------------|---------------------|----------|
| A | 1 | WU-001, WU-003, WU-005 | 3 | 2 hours |
| B | 1 | WU-002, WU-004 | 2 | 3 hours |
| C | 1 | WU-006, WU-007 | 2 | 3 hours |
| D | 2 | WU-008, WU-009, WU-010 | 3 | 2 hours |
| E | 2 | WU-011, WU-012 | 2 | 3 hours |
| F | 2 | WU-013, WU-014 | 2 | 2 hours |
| G | 2 | WU-015, WU-016 | 2 | 2 hours |
| H | 3 | WU-017, WU-018, WU-019, WU-020, WU-022 | 5 | 3 hours |
| I | 3 | WU-021, WU-024, WU-025 | 3 | 2 hours |
| J | 3 | WU-023, WU-026 | 2 | 4 hours |
| K | 4 | WU-027, WU-028, WU-030, WU-031, WU-032, WU-033 | 6 | 3 hours |
| L | 4 | WU-029 | 1 | 2 hours |
| M | 4 | WU-034, WU-035 | 2 | 3 hours |
| N | 5 | WU-036, WU-037, WU-038 | 3 | 3 hours |
| O | 5 | WU-039, WU-040, WU-041 | 3 | 4 hours |
| P | 5 | WU-042, WU-043, WU-044 | 3 | 2 hours |
| Q | 5 | WU-045, WU-046 | 2 | 3 hours |

**Peak Parallelization:** 6 agents (Group K, Phase 4)  
**Total Parallel Groups:** 17  
**Average Agents per Group:** 2.6

### 4.2 Agent Workload Distribution

**typescript-pro (Primary Developer):**
- Phase 1: WU-001, WU-002, WU-003, WU-004, WU-006 (13 hours)
- Phase 2: WU-009, WU-010, WU-011, WU-012, WU-014 (14 hours)
- Phase 3: WU-017, WU-018, WU-019, WU-020, WU-021, WU-022, WU-025 (16 hours)
- Phase 4: WU-027, WU-028, WU-029, WU-031, WU-032, WU-033, WU-035 (13 hours)
- Phase 5: WU-042, WU-043, WU-044, WU-045, WU-046 (11 hours)
- **Total: 67 hours (30 work units)**

**test-automator (Testing Specialist):**
- Phase 1: WU-007 (2 hours)
- Phase 2: WU-015, WU-016 (4 hours)
- Phase 3: WU-026 (3 hours)
- Phase 4: WU-034 (3 hours)
- Phase 5: WU-036, WU-037, WU-038, WU-039, WU-040, WU-041 (16 hours)
- **Total: 28 hours (11 work units)**

**backend-architect (Architecture & Design):**
- Phase 1: WU-005 (1 hour)
- Phase 2: WU-008, WU-013 (4 hours)
- Phase 3: WU-023 (4 hours)
- **Total: 9 hours (4 work units)**

**Workload Balance:** typescript-pro handles bulk of implementation, test-automator focuses on quality, backend-architect provides architectural guidance.

### 4.3 Coordination Protocol

**Using Memory MCP for Agent Coordination:**

1. **Work Unit Claiming:**
   - Agent queries memory for available work units (status: pending, no blocking dependencies)
   - Agent updates work unit entity status to "in-progress" with agent name
   - Other agents see work unit is claimed and select different unit

2. **File Locking:**
   - Agent creates memory entity "File Lock: {filepath}" when starting work
   - Entity includes: work unit ID, agent name, timestamp
   - Other agents check for file locks before claiming work units that touch same files

3. **Progress Reporting:**
   - Agents update work unit status observations in real-time
   - Status changes: pending → in-progress → completed (or blocked/failed)
   - Completion unlocks dependent work units

4. **Dependency Resolution:**
   - Memory tracks which work units are completed
   - Agents query dependencies before starting work
   - If dependency not complete, agent selects different work unit

**Example Memory Entities:**

```typescript
// Work unit tracking
Entity: "WU-001 Status"
  Observations:
    - "Status: completed"
    - "Agent: typescript-pro"
    - "Completion date: 2025-11-11T14:30:00Z"
    - "Files created: apps/cli/src/domain/config-v2.types.ts"

// File locking
Entity: "File Lock: apps/cli/src/core/sync-engine.ts"
  Observations:
    - "Locked by: WU-023"
    - "Agent: backend-architect"
    - "Locked at: 2025-11-11T15:00:00Z"

// Phase tracking
Entity: "Phase 1 Status"
  Observations:
    - "Total work units: 7"
    - "Completed: 5"
    - "In progress: 2 (WU-006, WU-007)"
    - "Pending: 0"
```

### 4.4 Conflict Resolution

**Scenario 1: Two Agents Want Same Work Unit**
- First agent to update memory entity status wins
- Second agent gets "already claimed" when trying to update
- Second agent selects different work unit from available pool

**Scenario 2: Dependent Work Units**
- Agent checks dependency status before claiming
- If dependency incomplete, agent selects different work unit
- Agent can periodically check if dependency completed

**Scenario 3: File Conflicts**
- Each work unit declares files it will create/modify
- Agent checks for file locks before starting
- If file locked, agent waits or selects different work unit

**Scenario 4: Blocking on Tests**
- Test work units can only start after implementation complete
- Test-automator agent waits for implementation work units
- Can work on tests for completed implementations while waiting

---

## 5. Memory Graph Design

### 5.1 Entity Structure

**Top-Level Entities:**

```
Overture v0.2 Implementation
├─ Implementation Status (overall)
├─ Phase 1 Status
├─ Phase 2 Status
├─ Phase 3 Status
├─ Phase 4 Status
├─ Phase 5 Status
├─ Architecture Decisions
├─ Blockers and Risks
└─ Performance Metrics

Work Units (46 entities)
├─ WU-001 Status
├─ WU-002 Status
├─ ...
└─ WU-046 Status

File Locks (dynamic)
├─ File Lock: {filepath}
└─ ...
```

**Entity Types:**

1. **Project Status Entity:**
   - Overall implementation progress
   - Current phase
   - Blockers list
   - Timeline adherence

2. **Phase Status Entities:**
   - Work units in phase
   - Completion percentage
   - Blocking issues
   - Estimated completion date

3. **Work Unit Status Entities:**
   - Status (pending|in-progress|completed|blocked|failed)
   - Assigned agent
   - Dependencies
   - Files touched
   - Start/completion timestamps
   - Blockers (if any)

4. **Architecture Decision Entities:**
   - Decision title
   - Rationale
   - Affected work units
   - Date decided

5. **Blocker Entities:**
   - Blocker description
   - Affected work units
   - Resolution status
   - Resolution notes

6. **File Lock Entities:**
   - File path
   - Locking work unit
   - Locking agent
   - Lock timestamp

### 5.2 Relations

```
Work Unit → depends_on → Work Unit
Work Unit → assigns_to → Agent
Work Unit → modifies → File
Work Unit → blocks → Work Unit
Phase → contains → Work Unit
Decision → affects → Work Unit
Blocker → blocks → Work Unit
```

### 5.3 Sample Memory Operations

**Claiming a Work Unit:**

```typescript
// Agent queries available work units
const availableWorkUnits = await memory.searchNodes('WU-* Status: pending');

// Agent picks first available with satisfied dependencies
const workUnit = availableWorkUnits[0];

// Agent claims work unit
await memory.addObservations({
  entityName: workUnit.name,
  contents: [
    'Status: in-progress',
    `Agent: ${agentName}`,
    `Started at: ${new Date().toISOString()}`
  ]
});

// Agent creates file locks
for (const file of workUnit.files) {
  await memory.createEntities({
    entities: [{
      name: `File Lock: ${file}`,
      entityType: 'FileLock',
      observations: [
        `Locked by: ${workUnit.name}`,
        `Agent: ${agentName}`,
        `Locked at: ${new Date().toISOString()}`
      ]
    }]
  });
}
```

**Completing a Work Unit:**

```typescript
// Agent completes work
await memory.addObservations({
  entityName: workUnit.name,
  contents: [
    'Status: completed',
    `Completed at: ${new Date().toISOString()}`,
    'All tests passing'
  ]
});

// Agent releases file locks
for (const file of workUnit.files) {
  await memory.deleteEntities({
    entityNames: [`File Lock: ${file}`]
  });
}

// Update phase status
await memory.addObservations({
  entityName: `Phase ${workUnit.phase} Status`,
  contents: [
    `${workUnit.name} completed`,
    `Completion percentage: ${calculatePercentage()}`
  ]
});
```

**Checking Dependencies:**

```typescript
// Agent checks if dependencies are satisfied
const dependencies = workUnit.dependencies; // ['WU-001', 'WU-002']

const statuses = await Promise.all(
  dependencies.map(dep => memory.openNodes({ names: [dep] }))
);

const allCompleted = statuses.every(node => 
  node.observations.includes('Status: completed')
);

if (!allCompleted) {
  console.log('Dependencies not satisfied, selecting different work unit');
}
```

### 5.4 Progress Dashboard

Agents can query memory to generate progress dashboard:

```
Overture v0.2 Implementation Progress

Phase 1: Foundation & Schema [▰▰▰▰▰▰▰▱▱▱] 70% (5/7 complete)
  ✓ WU-001: Config v2.0 Types (typescript-pro)
  ✓ WU-003: Path Resolution (typescript-pro)
  ✓ WU-005: File Organization (backend-architect)
  ✓ WU-002: Zod Schemas (typescript-pro)
  ✓ WU-004: Env Var Expansion (typescript-pro)
  ⚙ WU-006: Config Loader (typescript-pro - in progress)
  ⚙ WU-007: Schema Tests (test-automator - in progress)

Phase 2: Core Adapters [▱▱▱▱▱▱▱▱▱▱] 0% (0/9 complete)
  ⏸ WU-008: ClientAdapter Interface (blocked by WU-001)
  ⏸ WU-009: ClientPaths Detection (blocked by WU-003)
  ...

Overall Progress: [▰▰▱▱▱▱▱▱▱▱] 11% (5/46 complete)
Estimated Completion: Week 5, Day 5
Active Agents: 2 (typescript-pro, test-automator)
```

---

## 6. Risk Assessment

### 6.1 Technical Risks

**Risk: Environment Variable Expansion in Claude Desktop**
- **Impact:** HIGH
- **Probability:** MEDIUM
- **Description:** Research indicates Claude Desktop may not support ${VAR} expansion reliably
- **Mitigation:**
  - WU-025 implements client-aware expansion
  - Expand variables in Overture for Claude Desktop
  - Test thoroughly before v0.2 release
  - Document limitation if persistent

**Risk: Cross-Platform Path Detection**
- **Impact:** MEDIUM
- **Probability:** LOW
- **Description:** Platform-specific paths may not work on all systems
- **Mitigation:**
  - WU-003 implements comprehensive path resolver with tests
  - Mock all platform checks in tests
  - Test on real Windows/macOS/Linux systems
  - Document platform limitations

**Risk: Concurrent Sync Operations**
- **Impact:** HIGH
- **Probability:** MEDIUM
- **Description:** Users may run `overture sync` in multiple terminals
- **Mitigation:**
  - WU-022 implements process locking
  - Use proper-lockfile library with stale lock detection
  - Test locking with concurrent processes
  - Clear error messages for lock conflicts

**Risk: Backup File Corruption**
- **Impact:** HIGH
- **Probability:** LOW
- **Description:** Backup files could be corrupted or incomplete
- **Mitigation:**
  - WU-020 validates backups after creation
  - WU-021 validates backups before restore
  - Use atomic file writes
  - Test backup/restore thoroughly

**Risk: Schema Conversion Bugs**
- **Impact:** MEDIUM
- **Probability:** MEDIUM
- **Description:** Conversion between Overture and client schemas could lose data
- **Mitigation:**
  - WU-010 thoroughly tested schema conversion
  - Round-trip tests (convert → convert back → verify equal)
  - Validate after conversion
  - Log conversions for debugging

### 6.2 Coordination Risks

**Risk: Memory MCP Unavailable**
- **Impact:** HIGH
- **Probability:** LOW
- **Description:** If memory MCP fails, agents can't coordinate
- **Mitigation:**
  - Fallback to file-based coordination (JSON files)
  - Agents check memory availability before starting
  - Clear error messages if coordination fails
  - Documentation on manual coordination

**Risk: Agent Work Unit Conflicts**
- **Impact:** MEDIUM
- **Probability:** MEDIUM
- **Description:** Two agents claim same work unit despite coordination
- **Mitigation:**
  - Memory updates are atomic (first wins)
  - Agents verify claim succeeded before starting work
  - Regular status checks during work
  - Conflict resolution protocol documented

**Risk: Stale File Locks**
- **Impact:** MEDIUM
- **Probability:** MEDIUM
- **Description:** Agent crashes, leaving file locks in memory
- **Mitigation:**
  - Timestamp all locks
  - Agents check lock age before respecting lock
  - Locks older than 2 hours considered stale
  - Manual lock cleanup command

**Risk: Dependency Chain Deadlock**
- **Impact:** LOW
- **Probability:** LOW
- **Description:** Circular dependencies could block progress
- **Mitigation:**
  - Dependency graph validated before execution
  - No circular dependencies in design
  - Agents can detect and report deadlocks
  - Manual intervention if detected

### 6.3 Schedule Risks

**Risk: Work Unit Time Estimates**
- **Impact:** MEDIUM
- **Probability:** HIGH
- **Description:** Work units may take longer than estimated
- **Mitigation:**
  - 1-4 hour estimates are conservative
  - Buffer time in schedule (5 weeks for 92-184 hours)
  - Track actual time per work unit in memory
  - Adjust future estimates based on actuals

**Risk: Blocking Dependencies**
- **Impact:** HIGH
- **Probability:** MEDIUM
- **Description:** Critical path delays block subsequent work
- **Mitigation:**
  - Maximize parallelization where possible
  - Agents can work on non-blocked units
  - Critical path identified and monitored
  - Escalate blockers quickly

**Risk: Test Failures Block Progress**
- **Impact:** MEDIUM
- **Probability:** MEDIUM
- **Description:** Failing tests prevent moving to next phase
- **Mitigation:**
  - TDD approach (tests before implementation)
  - Test failures fixed immediately
  - Don't proceed to next phase with failing tests
  - Test-automator agent focused on quality

### 6.4 Quality Risks

**Risk: Incomplete Test Coverage**
- **Impact:** HIGH
- **Probability:** LOW
- **Description:** Features shipped without adequate testing
- **Mitigation:**
  - Phase 5 dedicated to testing
  - Coverage targets: 90%+ core code, 100% adapters
  - E2E tests for all major scenarios
  - Test coverage tracked in memory

**Risk: Poor Error Messages**
- **Impact:** MEDIUM
- **Probability:** MEDIUM
- **Description:** Users confused by cryptic errors
- **Mitigation:**
  - WU-035 and WU-046 focus on error messages
  - User testing of error scenarios
  - Error message review checklist
  - Documentation of common errors

**Risk: Breaking Changes from v0.1**
- **Impact:** MEDIUM
- **Probability:** HIGH
- **Description:** v0.2 breaks existing v0.1 users
- **Mitigation:**
  - WU-044 creates migration guide
  - Detect v0.1 configs and warn
  - Auto-migration tool (stretch goal)
  - Clear release notes

---

## 7. Testing Strategy

### 7.1 Testing Pyramid

```
       ╱╲
      ╱  ╲
     ╱ E2E ╲         11 E2E tests (WU-039, WU-040, WU-041)
    ╱──────╲
   ╱        ╲
  ╱Integration╲      15 integration tests (WU-034, WU-038)
 ╱────────────╲
╱              ╲
╱  Unit Tests   ╲    100+ unit tests (all .spec.ts files)
──────────────────
```

### 7.2 Unit Testing Strategy

**Coverage Targets:**
- **Core business logic:** 100% (config-loader, sync-engine, etc.)
- **Adapters:** 100% (all client adapters)
- **Utilities:** 90%+ (path-resolver, env-expander)
- **Commands:** 80%+ (CLI commands)

**Testing Approach:**
- TDD for core logic (write tests first)
- Mock all external dependencies (filesystem, process, etc.)
- Test edge cases and error paths
- Use Jest for all unit tests
- Fast execution (<5 seconds for all unit tests)

**Key Unit Test Work Units:**
- WU-007: Schema validation tests
- WU-015: ClaudeCodeAdapter tests
- WU-016: ClaudeDesktopAdapter tests
- WU-026: Sync engine tests
- WU-036: Complete adapter coverage
- WU-037: Complete sync engine coverage

### 7.3 Integration Testing Strategy

**Focus Areas:**
- Config loading with real YAML files
- Multi-component interactions (loader + validator + adapter)
- File system operations with test fixtures
- CLI command execution with real arguments

**Testing Approach:**
- Use real files (but in isolated test directories)
- Test entire workflows (not just individual units)
- Slower execution acceptable (1-2 minutes)
- Clean up test artifacts after each test

**Key Integration Test Work Units:**
- WU-034: CLI integration tests
- WU-038: Config loader integration tests

### 7.4 E2E Testing Strategy

**Focus Areas:**
- Complete sync workflow (config → sync → verify client configs)
- Backup and restore complete workflows
- Audit command with real client configs
- Multi-client scenarios

**Testing Approach:**
- Use real CLI binary (built with nx build)
- Real filesystem (but isolated test directories)
- Mock only external services (Claude CLI, etc.)
- Test on multiple platforms (CI/CD)
- Longest execution time acceptable (5-10 minutes)

**Key E2E Test Work Units:**
- WU-039: Multi-client sync E2E
- WU-040: Backup/restore E2E
- WU-041: Audit command E2E

### 7.5 Performance Testing Strategy

**Benchmarks:**
- Sync 10 MCPs to 2 clients: <500ms
- Sync 50 MCPs to 2 clients: <2s
- Sync 100 MCPs to 2 clients: <5s
- Config validation: <100ms
- Backup creation: <200ms

**Testing Approach:**
- Use real-world config sizes
- Test with various MCP counts
- Measure time with high precision
- Run multiple iterations (average results)
- Detect performance regressions

**Key Performance Test Work Unit:**
- WU-045: Performance testing and benchmarks

### 7.6 Testing Schedule

**Phase 1 (Week 1):**
- Unit tests for schema, path resolver, env expander
- Tests written alongside implementation

**Phase 2 (Week 2):**
- Unit tests for adapters and registry
- Tests for each adapter method

**Phase 3 (Week 3):**
- Unit tests for sync engine components
- Tests for backup, merge, diff, locking

**Phase 4 (Week 4):**
- Integration tests for CLI commands
- Tests for command execution and output

**Phase 5 (Week 5):**
- Complete unit test coverage (100%)
- Integration tests for config loading
- E2E tests for major workflows
- Performance benchmarks
- Final QA pass

---

## 8. Rollout Plan

### 8.1 Release Strategy

**v0.2.0-alpha.1 (Week 3, Day 5):**
- Phase 1 complete (Foundation & Schema)
- Phase 2 complete (Core Adapters)
- Phase 3 complete (Sync Engine)
- Limited testing (unit tests only)
- Internal testing only
- Feedback on architecture and APIs

**v0.2.0-beta.1 (Week 4, Day 5):**
- Phase 4 complete (Commands & Validation)
- Integration tests complete
- Feature-complete for Tier 1 clients
- Public beta testing
- Documentation complete
- Migration guide available

**v0.2.0 (Week 5, Day 5):**
- Phase 5 complete (Testing & Polish)
- E2E tests complete
- Performance validated
- All documentation updated
- Bug fixes from beta testing
- Production-ready release

**v0.2.1 (Week 7-8):**
- Tier 2 client adapters (VS Code, JetBrains Copilot, Copilot CLI)
- Extended features from research doc
- Additional polish based on v0.2.0 feedback

### 8.2 Feature Flags

**Use Feature Flags for Risky Features:**

```yaml
# apps/cli/src/config/feature-flags.ts
export const FEATURE_FLAGS = {
  USER_GLOBAL_CONFIG: true,        // v0.2.0
  CLAUDE_CODE_ADAPTER: true,        // v0.2.0
  CLAUDE_DESKTOP_ADAPTER: true,     // v0.2.0
  VSCODE_ADAPTER: false,            // v0.2.1
  JETBRAINS_ADAPTER: false,         // v0.2.1
  COPILOT_CLI_ADAPTER: false,       // v0.2.1
  AUTO_BACKUP: true,                // v0.2.0
  PROCESS_LOCKING: true,            // v0.2.0
};
```

**Benefits:**
- Disable features if bugs found
- Gradual rollout of adapters
- Easy A/B testing
- Quick rollback if needed

### 8.3 Incremental Delivery

**Week-by-Week Deliverables:**

**Week 1: Foundation**
- Deliver: Config v2.0 types, schemas, path resolver
- Demo: Load and validate user global config
- Milestone: Config infrastructure complete

**Week 2: Adapters**
- Deliver: ClientAdapter interface, ClaudeCode + ClaudeDesktop adapters
- Demo: Detect installed clients, read/write client configs
- Milestone: Adapter pattern proven

**Week 3: Sync Engine**
- Deliver: Sync orchestrator with backup, merge, locking
- Demo: Sync Overture config to 2 clients with backup
- Milestone: Core sync functionality complete

**Week 4: Commands**
- Deliver: All user-facing commands (user, sync, audit, backup)
- Demo: Complete CLI workflows from init to sync to audit
- Milestone: Feature-complete for Tier 1

**Week 5: Quality**
- Deliver: Complete test coverage, performance benchmarks, documentation
- Demo: All E2E scenarios passing, performance targets met
- Milestone: Production-ready v0.2.0

### 8.4 Rollback Strategy

**If Critical Bug Found:**

1. **Disable Feature Flag:**
   - Turn off problematic feature via feature flag
   - Redeploy without waiting for fix

2. **Revert to Previous Version:**
   - Git tag for each release
   - Easy to revert to v0.1.0 if v0.2.0 broken
   - Migration guide includes downgrade instructions

3. **Backup User Configs:**
   - Automatic backups before sync prevent data loss
   - Users can restore via `overture backup restore`

4. **Communication:**
   - Clear release notes with known issues
   - GitHub issues for bug reports
   - Quick hotfix releases if needed

### 8.5 Success Criteria

**v0.2.0 is successful if:**

1. **Functionality:**
   - ✅ User global config works across platforms
   - ✅ Multi-client sync works (Claude Code + Claude Desktop)
   - ✅ Backup/restore prevents data loss
   - ✅ Audit detects unmanaged MCPs
   - ✅ All v0.2.0 features documented

2. **Quality:**
   - ✅ 90%+ test coverage on core code
   - ✅ 100% test coverage on adapters
   - ✅ All E2E tests passing
   - ✅ Performance targets met

3. **Usability:**
   - ✅ Migration from v0.1 is smooth
   - ✅ Error messages are helpful
   - ✅ Documentation is comprehensive
   - ✅ No critical bugs reported

4. **Adoption:**
   - ✅ v0.1 users upgrade without issues
   - ✅ New users can onboard easily
   - ✅ Positive feedback on multi-client sync

---

## 9. Appendix

### 9.1 File Structure Overview

```
overture/
├── apps/
│   ├── cli/
│   │   └── src/
│   │       ├── adapters/            # Phase 2
│   │       │   ├── client-adapter.interface.ts
│   │       │   ├── adapter-registry.ts
│   │       │   ├── claude-code-adapter.ts
│   │       │   ├── claude-desktop-adapter.ts
│   │       │   ├── path-detector.ts
│   │       │   └── schema-converter.ts
│   │       ├── commands/            # Phase 4
│   │       │   ├── user.command.ts
│   │       │   ├── sync.command.ts  (modified)
│   │       │   ├── audit.command.ts
│   │       │   ├── backup.command.ts
│   │       │   └── mcp.command.ts   (modified)
│   │       ├── core/                # Phase 1 & 3
│   │       │   ├── config-loader.ts
│   │       │   ├── path-resolver.ts
│   │       │   ├── env-expander.ts
│   │       │   ├── sync-engine.ts
│   │       │   ├── backup-service.ts
│   │       │   ├── restore-service.ts
│   │       │   ├── process-lock.ts
│   │       │   ├── merge-strategy.ts
│   │       │   ├── config-diff.ts
│   │       │   ├── exclusion-filter.ts
│   │       │   ├── transport-validator.ts
│   │       │   ├── client-env-expander.ts
│   │       │   ├── client-detector.ts
│   │       │   ├── audit-service.ts
│   │       │   └── error-handler.ts
│   │       ├── domain/              # Phase 1
│   │       │   ├── config-v2.types.ts
│   │       │   └── config-v2.schema.ts
│   │       └── utils/
│   └── cli-e2e/                    # Phase 5
│       └── src/
│           ├── sync-multi-client.spec.ts
│           ├── backup-restore.spec.ts
│           └── audit.spec.ts
└── docs/
    ├── v0.2-implementation-plan.md (this file)
    ├── v0.2-architecture.md
    ├── config-v2-examples.md
    └── migration-v0.1-to-v0.2.md
```

### 9.2 Technology Stack

- **Language:** TypeScript 5.x
- **Build Tool:** Nx 22.x
- **CLI Framework:** Commander.js
- **Schema Validation:** Zod
- **Testing:** Jest
- **YAML Parsing:** js-yaml
- **File Locking:** proper-lockfile
- **Process Management:** Node.js child_process

### 9.3 External Dependencies

```json
{
  "dependencies": {
    "commander": "^12.0.0",
    "zod": "^3.22.0",
    "js-yaml": "^4.1.0",
    "proper-lockfile": "^4.1.2"
  },
  "devDependencies": {
    "@nx/esbuild": "22.1.4",
    "@nx/eslint": "22.1.4",
    "@nx/jest": "22.1.4",
    "@nx/js": "22.1.4",
    "@types/jest": "^29.5.12",
    "@types/js-yaml": "^4.0.9",
    "jest": "^29.7.0",
    "typescript": "~5.7.2"
  }
}
```

### 9.4 Communication Channels

**For Parallel Agents:**
- **Primary:** Memory MCP for coordination
- **Backup:** File-based coordination (JSON files in .overture/coordination/)
- **Logging:** Console output with structured logs
- **Errors:** Captured in memory entities + log files

**For Human Coordination:**
- **GitHub Issues:** Bug reports and feature requests
- **GitHub Discussions:** Design discussions and questions
- **Pull Requests:** Code review and collaboration
- **Slack/Discord:** Real-time communication (if applicable)

---

## 10. Implementation Progress (Updated: 2025-11-11)

### Phase Completion Status

| Phase | Status | Work Units | Tests | Completion Date |
|-------|--------|------------|-------|----------------|
| **Phase 1: Foundation** | ✅ COMPLETE | 13/13 | 191 | 2025-11-09 (v0.1) |
| **Phase 2: Client Adapters** | ✅ COMPLETE | 16/16 | 653 | 2025-11-11 |
| **Phase 3: Sync Engine** | ✅ COMPLETE | 10/10 | 802 | 2025-11-11 |
| **Phase 4: Commands & Validation** | 📋 PENDING | 0/9 | - | - |
| **Phase 5: Testing & Polish** | 📋 PENDING | 0/11 | - | - |

**Overall Progress:** 39/59 work units complete (66%)
**Test Coverage:** 802 tests passing, 26 test suites

### Completed Deliverables

**Phase 1 (v0.1 Foundation):**
- ✅ Domain types and Zod schemas (config-v2.types.ts, config-v2.schema.ts)
- ✅ Path resolver with cross-platform support
- ✅ Environment variable expander
- ✅ Config loader with user/project precedence
- ✅ Template system with Handlebars
- ✅ Basic CLI commands (init, sync, validate, mcp)

**Phase 2 (Client Adapters):**
- ✅ BaseClientAdapter abstract class with shouldSyncMcp() helper
- ✅ Core adapters: claude-code-adapter, claude-desktop-adapter, vscode-adapter
- ✅ Extended adapters: cursor-adapter, windsurf-adapter, copilot-cli-adapter, jetbrains-copilot-adapter
- ✅ Adapter registry (adapter-registry.ts)
- ✅ Comprehensive test suite (31 tests for extended adapters)

**Phase 3 (Sync Engine):**
- ✅ Config diff service (config-diff.ts) - 19 tests
- ✅ Backup/restore services (backup-service.ts, restore-service.ts) - 50 tests
- ✅ Process locking (process-lock.ts) - 18 tests
- ✅ Exclusion filter (exclusion-filter.ts) - 16 tests
- ✅ Transport validator (transport-validator.ts) - 22 tests
- ✅ Client-aware env expansion (client-env-service.ts) - 19 tests
- ✅ Main sync orchestrator (sync-engine.ts) - 21 tests

### Active Work

**Current Focus:** Phase 4 - Commands & Validation (9 WUs remaining)

**Next Work Units:**
- WU-027: User config commands (user.command.ts)
- WU-028: Audit command (audit.command.ts)
- WU-030: Backup commands (backup.command.ts)
- WU-031: Restore commands (restore.command.ts)
- WU-032: Enhanced sync command with multi-client
- WU-033: Config validation utilities
- WU-029: Integration orchestration tests
- WU-034: Error handling and reporting
- WU-035: Command-line UX improvements

### Key Achievements

1. **Multi-Client Architecture:** Successfully implemented adapters for 7 different AI development clients
2. **Robust Sync Engine:** Comprehensive orchestration with locking, backup, diff, filtering, and validation
3. **High Test Coverage:** 802 tests across 26 test suites with integration testing
4. **Pattern Consistency:** BaseClientAdapter provides uniform interface for all clients
5. **Platform Support:** Cross-platform path resolution for darwin, linux, win32
6. **Environment Handling:** Client-aware expansion (native vs Overture-managed)

### Technical Decisions

- **Override Order:** Platform overrides → Client overrides
- **Transport Warnings:** Check compatibility BEFORE filtering to provide clear warnings
- **Process Safety:** File-based locking with stale detection and auto-cleanup
- **Backup Strategy:** Timestamped files with 10-backup retention
- **Graceful Degradation:** Backup failures don't stop sync, uninstalled clients skipped
- **Dry-run Support:** Preview changes without side effects

---

## 11. Conclusion

This implementation plan provides a comprehensive roadmap for Overture v0.2 development with parallel execution support. The plan breaks down the work into 46 isolated work units organized into 17 parallel groups across 5 phases.

**Key Highlights:**

- **Parallel Execution:** Up to 6 agents can work simultaneously
- **Clear Dependencies:** All dependencies mapped and visualized
- **Coordination via Memory MCP:** Agents coordinate without conflicts
- **Comprehensive Testing:** Unit, integration, E2E, and performance tests
- **Incremental Delivery:** Weekly milestones with demos
- **Risk Mitigation:** Identified risks with mitigation strategies

**Next Steps:**

1. Review and approve this plan
2. Initialize memory graph entities for tracking
3. Assign initial work units to agents (Phase 1, Group A)
4. Begin parallel execution
5. Monitor progress via memory graph dashboard
6. Adjust plan based on actual progress and learnings

**Estimated Timeline:** 5 weeks from start to v0.2.0 release with parallel agent execution.

---

**Document Status:** DRAFT - Ready for Review  
**Author:** Claude Code (Sonnet 4.5)  
**Date:** 2025-11-11
