# Overture Configuration Schema

## Overview

Overture bridges Claude Code plugins and MCP servers by:
1. Installing plugins via Claude CLI based on configuration
2. Generating `.mcp.json` with project-scoped MCP servers
3. Generating `CLAUDE.md` with plugin↔MCP usage guidance

## Configuration Files

### Global Configuration: `~/.config/overture/config.yaml`

Defines user-level preferences and globally available MCP servers.

```yaml
version: "1.0"

# Global MCP servers (configured in ~/.config/claude/mcp.json)
mcp:
  sequentialthinking:
    scope: global

  filesystem:
    scope: global

  memory:
    scope: global

  context7:
    scope: global

  nx:
    scope: global

# Default plugins for new projects
default_plugins:
  - code-review-ai
  - git-pr-workflows
```

### Project Configuration: `<project>/.overture/config.yaml`

Declares which plugins to install and which MCP servers to configure.

```yaml
version: "1.0"

project:
  name: my-app
  type: python-backend
  description: FastAPI backend service

# Plugins to install via Claude CLI
plugins:
  python-development:
    marketplace: claude-code-workflows  # Uses: claude plugin install python-development@claude-code-workflows
    enabled: true
    mcps: [python-repl, ruff, filesystem]  # MCPs this plugin uses

  backend-development:
    marketplace: claude-code-workflows
    enabled: true
    mcps: [filesystem, docker]

  database-design:
    marketplace: claude-code-workflows
    enabled: true
    mcps: [sqlite, filesystem]

# MCP server configurations
mcp:
  # Global MCPs (reference only, configured in ~/.config/claude/mcp.json)
  filesystem:
    scope: global

  # Project-scoped MCPs (will be added to .mcp.json)
  python-repl:
    command: uvx
    args: [mcp-server-python-repl]
    scope: project

  ruff:
    command: uvx
    args: [mcp-server-ruff]
    scope: project

  docker:
    command: docker-mcp-server
    scope: project

  sqlite:
    command: uvx
    args: [mcp-server-sqlite, --db-path, ./dev.db]
    scope: project

  github:
    command: mcp-server-github
    env:
      GITHUB_TOKEN: "${GITHUB_TOKEN}"
    scope: project

  postgres:
    command: docker
    args: [run, -i, --rm, mcp-postgres]
    env:
      POSTGRES_URL: "${DATABASE_URL}"
    scope: project
    enabled: false  # Disabled by default, enable with: overture enable mcp postgres
```

## Schema Definitions

### Plugin Declaration

```yaml
plugin_name:
  marketplace: string         # Marketplace name (e.g., claude-code-workflows)
  enabled: boolean           # Whether plugin is enabled (default: true)
  mcps: string[]            # List of MCP server names this plugin uses
```

### MCP Server Declaration

```yaml
mcp_server_name:
  # Execution configuration
  command: string              # Executable command
  args: string[]              # Command arguments (optional)
  env: map<string, string>    # Environment variables (optional)

  # Metadata
  scope: global | project     # Where this MCP is configured
  enabled: boolean            # Whether server is active (default: true)
```

## Generated CLAUDE.md Structure

```markdown
# {Project Name}

Generated by Overture v1.0.0

## Project Info
- Name: {project.name}
- Type: {project.type}
- Description: {project.description}

## Active Plugins

{for each enabled plugin}
- **{plugin.name}** (marketplace: {plugin.marketplace})

## MCP Server Configuration

### Global MCP Servers
Available in all projects (configured in ~/.config/claude/mcp.json):
{for each global MCP referenced}
- {mcp.name}

### Project MCP Servers
Configured for this project (in .mcp.json):
{for each project MCP}
- **{mcp.name}**
  {if not enabled}
  - Status: ⚠️ Disabled (enable with: overture enable mcp {mcp.name})

## Plugin-to-MCP Mappings

This section tells Claude which MCP servers to use for each plugin.

{for each enabled plugin}
### {plugin.name}

When using {plugin.name}, prefer these MCP servers:
{for each mcp in plugin.mcps}
- `{mcp.name}` MCP

---
*Auto-generated by Overture. Do not edit above this line.*
*Manual edits below will be preserved.*

<!-- overture:custom -->

<!-- /overture:custom -->
```

## TypeScript Schema

```typescript
interface OvertureConfig {
  version: string;
  project?: ProjectConfig;
  plugins: Record<string, PluginConfig>;
  mcp: Record<string, McpServerConfig>;
}

interface ProjectConfig {
  name: string;
  type?: string;
  description?: string;
}

interface PluginConfig {
  marketplace: string;      // e.g., "claude-code-workflows"
  enabled?: boolean;        // default: true
  mcps: string[];          // List of MCP names this plugin uses
}

interface McpServerConfig {
  command?: string;         // Not needed for global scope references
  args?: string[];
  env?: Record<string, string>;
  scope: 'global' | 'project';
  enabled?: boolean;        // default: true
}
```

## Workflows

### Initialize New Project
```bash
overture init --type python-backend
# Creates .overture/config.yaml with defaults
# User edits config to add plugins and MCPs
```

### Sync Configuration
```bash
overture sync
# 1. Installs missing plugins via Claude CLI
#    claude plugin install python-development@claude-code-workflows
# 2. Generates .mcp.json with project-scoped MCPs
# 3. Generates/updates CLAUDE.md with plugin↔MCP mappings
```

### Enable a Disabled MCP
```bash
overture enable mcp postgres
# Sets enabled: true in .overture/config.yaml
# Regenerates .mcp.json
# Updates CLAUDE.md
```

### List MCP Servers
```bash
overture mcp list
# Shows all configured MCPs
# Indicates global vs project scope
# Shows which plugins use each MCP
# Indicates enabled/disabled status
```

### Validate Configuration
```bash
overture validate
# Checks config schema validity
# Verifies MCP commands exist on PATH
# Warns if plugins reference undefined MCPs
```
